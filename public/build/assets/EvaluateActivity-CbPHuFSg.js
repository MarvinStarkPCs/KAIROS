import{r as A,j as e,H as R,L as E,a as I}from"./app-C_wc9es_.js";import{A as V}from"./app-layout-RCkHY00m.js";import{B as g}from"./button-CK7_c_5e.js";import{C as j,b as P,c as S,a as v}from"./card-qYJq1A3u.js";import{B as m}from"./badge-BXPN97dQ.js";import{I as T}from"./input-C7PQsbVn.js";import{T as z}from"./textarea-CrDkFOvc.js";import{L as N}from"./label-nyAx6Y8t.js";import{I as w}from"./app-header-3tM_PALz.js";import{A as O}from"./arrow-left-BuK2liDJ.js";import{G as q}from"./graduation-cap-DpEnpuH4.js";import{T as _}from"./triangle-alert-C5Oz38JB.js";import{C as J}from"./circle-check-big-e5VBrFsL.js";import{S as K}from"./save-CHLEvTq7.js";/* empty css            */import"./utils-BTwnVSy2.js";import"./index-myZmSymV.js";import"./index-Be2p5AN3.js";import"./createLucideIcon-Cl_h1Hpc.js";import"./index-BPZo39PE.js";import"./index-DJBO6EKN.js";import"./index-BLRCw3fc.js";import"./toaster-eRoXJvOx.js";import"./index-CNhhqjg2.js";import"./chevron-right-FEguOG6w.js";import"./index-BXFwRZdy.js";import"./index-CLa6oRL-.js";import"./wayfinder-Bf9OnZdi.js";import"./index-D12nj1Ca.js";import"./book-open-DgLAYnVa.js";import"./users-BlXHteJc.js";import"./credit-card-Cyqos1IL.js";import"./calendar-CdY4SBhE.js";import"./file-text-BcV-VVC0.js";import"./lock-l4QBdaDv.js";import"./shield-Dk7fcTnH.js";import"./chevron-down-D4MJa3Wh.js";import"./loader-circle-DIXjFJg0.js";import"./mail-jATxNgrm.js";function Me({schedule:x,activity:i,students:d}){const[k,B]=A.useState(new Date().toISOString().split("T")[0]),[u,y]=A.useState(()=>{const a={};return d.forEach(r=>{a[r.id]={student_id:r.id,criteria:i.evaluation_criteria.map(s=>{const o=r.existing_evaluations.find(t=>t.evaluation_criteria_id===s.id);return{evaluation_criteria_id:s.id,points_earned:Number(o?.points_earned??0)}}),feedback:r.existing_evaluations[0]?.feedback||""}}),a}),M=(a,r,s)=>{const o=parseFloat(s)||0,t=i.evaluation_criteria.find(l=>l.id===r)?.max_points??0,h=Math.min(Math.max(o,0),t);y(l=>({...l,[a]:{...l[a],criteria:l[a].criteria.map(n=>n.evaluation_criteria_id===r?{...n,points_earned:h}:n)}}))},L=(a,r)=>{y(s=>({...s,[a]:{...s[a],feedback:r}}))},$=a=>{const r=u[a]?.criteria;return!r||r.length===0?0:r.reduce((s,o)=>s+Number(o.points_earned||0),0)},b=()=>!i.evaluation_criteria||i.evaluation_criteria.length===0?0:i.evaluation_criteria.reduce((a,r)=>a+Number(r.max_points||0),0),F=a=>{const r=b(),s=$(a);return r>0?Math.round(s/r*100):0},p=a=>a>=80?"text-green-600":a>=60?"text-blue-600":a>=40?"text-amber-600":"text-red-600",W=a=>a>=80?"stroke-green-500":a>=60?"stroke-blue-500":a>=40?"stroke-amber-500":"stroke-red-500",D=a=>a>=80?"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800":a>=60?"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800":a>=40?"bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800":"bg-red-50 dark:bg-red-950/30 border-red-200 dark:border-red-800",G=a=>a>=90?"Excelente":a>=80?"Muy bien":a>=70?"Bien":a>=60?"Aceptable":a>=40?"Insuficiente":"Bajo",H=()=>{const a=d.filter(s=>s.has_attendance);if(a.length===0){alert("No hay estudiantes con asistencia registrada para evaluar. Primero debe marcar asistencia.");return}const r=a.map(s=>u[s.id]);I.post(`/profesor/grupo/${x.id}/actividad/${i.id}/evaluaciones`,{evaluation_date:k,evaluations:r})},c=d.filter(a=>a.has_attendance).length,C=d.filter(a=>!a.has_attendance).length;return e.jsxs(V,{variant:"sidebar",title:`Evaluar: ${i.name} - Portal Profesor`,children:[e.jsx(R,{title:`Evaluar: ${i.name} - Portal Profesor`}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Evaluar Actividad"}),e.jsx("p",{className:"text-muted-foreground",children:x.program.name})]}),e.jsx(E,{href:`/profesor/grupo/${x.id}`,children:e.jsxs(g,{variant:"outline",children:[e.jsx(w,{iconNode:O,className:"w-4 h-4 mr-2"}),"Volver"]})})]})}),e.jsxs(j,{className:"mb-6",children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-2xl mb-2",children:i.name}),e.jsx("p",{className:"text-muted-foreground mb-3",children:i.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",children:i.study_plan.module_name}),e.jsxs(m,{variant:"secondary",children:["Peso: ",i.weight,"%"]}),e.jsxs(m,{variant:"secondary",children:["Puntaje Total: ",b()," puntos"]})]})]}),e.jsx(w,{iconNode:q,className:"w-12 h-12 text-[#7a9b3c]"})]})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx(N,{htmlFor:"evaluation_date",children:"Fecha de Evaluación"}),e.jsx(T,{id:"evaluation_date",type:"date",value:k,onChange:a=>B(a.target.value),className:"max-w-xs"})]})})]}),C>0&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Estudiantes sin asistencia registrada"}),e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:[C," estudiante(s) no tienen asistencia registrada y no pueden ser evaluados.",c>0&&` Solo se evaluarán ${c} estudiante(s) con asistencia.`]}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:'Vaya a la pestaña "Marcar Asistencia" para registrar la asistencia antes de evaluar.'})]})]})}),e.jsx("div",{className:"space-y-6",children:d.length===0?e.jsx(j,{children:e.jsx(v,{className:"py-12 text-center text-muted-foreground",children:"No hay estudiantes para evaluar"})}):d.map(a=>{const r=F(a.id),s=$(a.id),o=b();return e.jsxs("div",{children:[a.has_attendance&&e.jsxs("div",{className:`sticky top-0 z-20 flex items-center justify-between rounded-t-lg border border-b-0 px-4 py-2 shadow-md ${D(r)}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative h-11 w-11 flex-shrink-0",children:[e.jsxs("svg",{className:"h-11 w-11 -rotate-90",viewBox:"0 0 48 48",children:[e.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"none",className:"stroke-muted",strokeWidth:"4"}),e.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"none",className:`transition-all duration-500 ${W(r)}`,strokeWidth:"4",strokeLinecap:"round",strokeDasharray:`${r/100*125.7} 125.7`})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:`text-xs font-bold ${p(r)}`,children:[r,"%"]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:`text-base font-bold ${p(r)}`,children:[s," / ",o," pts"]}),e.jsx("div",{className:`text-xs font-medium ${p(r)}`,children:G(r)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground hidden sm:inline",children:a.name}),e.jsx("div",{className:"hidden sm:block w-32",children:e.jsx("div",{className:"h-3 w-full overflow-hidden rounded-full bg-white/60",children:e.jsx("div",{className:`h-full transition-all duration-500 rounded-full ${r>=80?"bg-green-500":r>=60?"bg-blue-500":r>=40?"bg-amber-500":"bg-red-500"}`,style:{width:`${Math.min(r,100)}%`}})})})]})]}),e.jsxs(j,{className:`${a.has_attendance?"rounded-t-none":"border-yellow-300 dark:border-yellow-700 bg-yellow-50/50"}`,children:[e.jsx(P,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{children:a.name}),a.has_attendance?e.jsxs(m,{className:"bg-green-500",children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"Asistencia registrada"]}):e.jsxs(m,{variant:"destructive",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Sin asistencia"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[a.document_number&&e.jsxs("span",{className:"font-medium text-muted-foreground",children:[a.document_type,": ",a.document_number]}),e.jsx("span",{children:a.email})]}),a.has_attendance&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Asistencia: ",a.attendance_stats.present,"P / ",a.attendance_stats.late,"T / ",a.attendance_stats.absent,"A (",a.attendance_stats.total," clases)"]})]})})}),e.jsx(v,{children:a.has_attendance?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-3",children:"Criterios de Evaluación"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.evaluation_criteria.map(t=>{const h=Number(u[a.id]?.criteria.find(f=>f.evaluation_criteria_id===t.id)?.points_earned??0),l=Number(t.max_points||0),n=l>0?Math.round(h/l*100):0;return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{htmlFor:`student-${a.id}-criteria-${t.id}`,className:"text-sm font-medium",children:t.name}),e.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${n>=80?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":n>=60?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":n>=40?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:[n,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{id:`student-${a.id}-criteria-${t.id}`,type:"number",min:"0",max:t.max_points,step:"0.5",value:h,onChange:f=>M(a.id,t.id,f.target.value),className:"w-24 text-center"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"/"}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[t.max_points," pts"]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:`h-full transition-all duration-300 rounded-full ${n>=80?"bg-green-500":n>=60?"bg-blue-500":n>=40?"bg-amber-500":"bg-red-500"}`,style:{width:`${Math.min(n,100)}%`}})})})]}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]},t.id)})})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:`feedback-${a.id}`,children:"Retroalimentación (opcional)"}),e.jsx(z,{id:`feedback-${a.id}`,placeholder:"Escribe comentarios o sugerencias para el estudiante...",value:u[a.id]?.feedback||"",onChange:t=>L(a.id,t.target.value),rows:3})]})]}):e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-300 dark:border-yellow-700 rounded-lg p-4 text-center",children:[e.jsx(_,{className:"w-8 h-8 text-yellow-600 mx-auto mb-2"}),e.jsx("p",{className:"text-yellow-800 dark:text-yellow-200 font-medium",children:"No se puede evaluar a este estudiante"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300 text-sm mt-1",children:"Primero debe registrar al menos una asistencia para este estudiante."})]})})]})]},a.id)})}),d.length>0&&e.jsxs("div",{className:"mt-8 flex gap-4",children:[e.jsxs(g,{onClick:H,className:"flex-1 bg-[#7a9b3c] hover:bg-[#6a8a2c] text-lg py-6 disabled:opacity-50",disabled:c===0,children:[e.jsx(w,{iconNode:K,className:"w-5 h-5 mr-2"}),c===0?"No hay estudiantes para evaluar":`Guardar Evaluaciones (${c} estudiante${c!==1?"s":""})`]}),e.jsx(E,{href:`/profesor/grupo/${x.id}`,className:"flex-shrink-0",children:e.jsx(g,{variant:"outline",className:"text-lg py-6",children:"Cancelar"})})]})]})]})}export{Me as default};
