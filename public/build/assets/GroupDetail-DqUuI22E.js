import{r as x,j as e,H as J,L as B,a as X}from"./app-BaXjNCFI.js";import{A as K}from"./app-layout-DuWAgTx6.js";import{B as m}from"./button-CqgkN_bD.js";import{C as _,b as w,c as C,d as F,a as k}from"./card-1xgg44t6.js";import{B as n}from"./badge-BrmWodLl.js";import{T as Q,a as W,b as S,c as A}from"./tabs-DosUstX-.js";import{D as Y,a as Z,b as ee,c as se,d as ae}from"./dialog-CU64FCag.js";import{I as c}from"./app-header-C5H93Cm8.js";import{C as M}from"./clock-BN2aWjBV.js";import{M as te}from"./map-pin-7LE1Lo4k.js";import{C as re}from"./clipboard-check-CE0uRyl2.js";import{U as le}from"./users-BH4ovMhy.js";import{G as ie}from"./graduation-cap-D_P3KA52.js";import{C as ne}from"./calendar-CDlpmbFf.js";import{E as de}from"./eye-BJkc-q8B.js";import{C as E}from"./circle-check-big-Bhddl8-U.js";import{C as L}from"./circle-alert-C4WOmkFS.js";import{C as z}from"./circle-x-CwtEGJsq.js";import{C as ce}from"./chevron-right-DjHtPILm.js";import{B as H,L as me}from"./list-checks-CNi8D8PV.js";import{L as G}from"./lock-DOfq83W7.js";import{A as oe}from"./index-CKZtrCnb.js";/* empty css            */import"./utils-DI6M6IAA.js";import"./index-DvlFhzQF.js";import"./index-C6nXMBex.js";import"./createLucideIcon-e1LOwzzH.js";import"./index-BkW6PfOW.js";import"./index-Co4asjq1.js";import"./index-CKdtPxUE.js";import"./toaster-CDPrOrpu.js";import"./index-CFFEOp2d.js";import"./index-BjQl2Umo.js";import"./index-CLa6oRL-.js";import"./wayfinder-Bf9OnZdi.js";import"./credit-card-B5k5iQJ0.js";import"./file-text-p_O4wBSz.js";import"./shield-D29pX0VW.js";import"./loader-circle-_bb5_np4.js";import"./mail-BlU4MZeN.js";function Ye({schedule:i,students:o,activities:h,classDates:P}){const[g,$]=x.useState({}),[T,u]=x.useState({}),[d,O]=x.useState(null),[l,N]=x.useState(null),R=x.useMemo(()=>{const s={};h.forEach(a=>{const r=a.study_plan.module_name;s[r]||(s[r]={moduleName:a.study_plan.module_name,description:a.study_plan.description,hours:a.study_plan.hours??0,level:a.study_plan.level??0,activities:[],isFullyEvaluated:!0}),s[r].activities.push(a),a.is_fully_evaluated||(s[r].isFullyEvaluated=!1)});const t=Object.values(s).sort((a,r)=>a.level-r.level||a.moduleName.localeCompare(r.moduleName));return t.map((a,r)=>{let p=!1;if(r>0){for(let y=0;y<r;y++)if(!t[y].isFullyEvaluated){p=!0;break}}return{...a,isLocked:p}})},[h]),D=s=>{O(s);const t={},a={};o.forEach(r=>{r.attendance_by_date[s]&&(t[r.id]=r.attendance_by_date[s].status,a[r.id]=r.attendance_by_date[s].notes||"")}),$(t),u(a)},v=(s,t)=>{$(a=>({...a,[s]:t})),t==="present"&&u(a=>({...a,[s]:""}))},I=(s,t)=>{u(a=>({...a,[s]:t}))},V=()=>{if(!d)return;const s=Object.entries(g).map(([t,a])=>({student_id:parseInt(t),status:a,notes:T[parseInt(t)]||""}));if(s.length===0){alert("Debes marcar al menos un estudiante");return}X.post(`/profesor/grupo/${i.id}/asistencia`,{class_date:d,attendances:s})},U=s=>{switch(s){case"present":return e.jsx(E,{className:"w-4 h-4 text-green-500"});case"late":return e.jsx(L,{className:"w-4 h-4 text-yellow-500"});case"absent":return e.jsx(z,{className:"w-4 h-4 text-red-500"});default:return e.jsx(M,{className:"w-4 h-4 text-gray-400"})}},q=s=>{switch(s){case"present":return e.jsx(n,{className:"bg-green-500",children:"Presente"});case"late":return e.jsx(n,{className:"bg-yellow-500",children:"Tarde"});case"absent":return e.jsx(n,{variant:"destructive",children:"Ausente"});default:return e.jsx(n,{variant:"outline",children:"Sin marcar"})}},j=s=>new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}),b=P.filter(s=>s.is_past||s.is_today),f=P.filter(s=>!s.is_past&&!s.is_today);return e.jsxs(K,{variant:"sidebar",title:`${i.program.name} - Portal Profesor`,children:[e.jsx(J,{title:`${i.program.name} - Portal Profesor`}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:i.program.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-gray-600",children:[e.jsx(n,{style:{backgroundColor:i.program.color},className:"text-white",children:i.days_of_week}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(c,{iconNode:M,className:"w-4 h-4 mr-1"}),i.start_time," - ",i.end_time]}),i.location&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(c,{iconNode:te,className:"w-4 h-4 mr-1"}),i.location]})]})]}),e.jsx(B,{href:"/profesor/mis-grupos",children:e.jsx(m,{variant:"outline",children:"Volver"})})]})}),e.jsxs(Q,{defaultValue:"attendance",className:"space-y-6",children:[e.jsxs(W,{className:"grid w-full grid-cols-3",children:[e.jsxs(S,{value:"attendance",children:[e.jsx(c,{iconNode:re,className:"w-4 h-4 mr-2"}),"Asistencia"]}),e.jsxs(S,{value:"students",children:[e.jsx(c,{iconNode:le,className:"w-4 h-4 mr-2"}),"Estudiantes (",o.length,")"]}),e.jsxs(S,{value:"activities",children:[e.jsx(c,{iconNode:ie,className:"w-4 h-4 mr-2"}),"Actividades (",h.length,")"]})]}),e.jsx(A,{value:"attendance",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(_,{className:"lg:col-span-1",children:[e.jsxs(w,{children:[e.jsx(C,{className:"text-lg",children:"Fechas de Clase"}),e.jsx(F,{children:"Selecciona una fecha para marcar asistencia"})]}),e.jsx(k,{className:"max-h-[500px] overflow-y-auto",children:b.length===0&&f.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay fechas de clase configuradas"}):e.jsxs("div",{className:"space-y-2",children:[b.map(s=>e.jsx("div",{onClick:()=>D(s.date),className:`p-3 rounded-lg border cursor-pointer transition-colors ${d===s.date?"border-[#7a9b3c] bg-[#7a9b3c]/10":"hover:bg-gray-50"} ${s.is_today?"border-blue-500 border-2":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.day_name,s.is_today&&e.jsx(n,{className:"bg-blue-500 text-xs",children:"Hoy"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:j(s.date)})]}),e.jsxs("div",{className:"text-right",children:[s.marked_count>0?e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsxs("span",{className:"text-green-600",children:[s.present_count,"P"]}),e.jsxs("span",{className:"text-yellow-600",children:[s.late_count,"T"]}),e.jsxs("span",{className:"text-red-600",children:[s.absent_count,"A"]})]}):e.jsx(n,{variant:"outline",className:"text-xs",children:"Sin marcar"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.marked_count,"/",s.total_students]})]})]})},s.date)),f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase mt-4 mb-2",children:"Próximas clases"}),f.map(s=>e.jsx("div",{className:"p-3 rounded-lg border bg-gray-50 opacity-60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.day_name}),e.jsx("div",{className:"text-sm text-gray-500",children:j(s.date)})]}),e.jsx(n,{variant:"outline",className:"text-xs",children:"Próxima"})]})},s.date))]})]})})]}),e.jsxs(_,{className:"lg:col-span-2",children:[e.jsxs(w,{children:[e.jsx(C,{className:"text-lg",children:d?`Asistencia - ${j(d)}`:"Marcar Asistencia"}),e.jsx(F,{children:d?"Marca la asistencia de cada estudiante":"Selecciona una fecha de la lista para marcar asistencia"})]}),e.jsx(k,{children:d?o.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No hay estudiantes inscritos"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 mb-6 max-h-[400px] overflow-y-auto",children:o.map(s=>{const t=g[s.id]||s.attendance_by_date[d]?.status,a=T[s.id]??s.attendance_by_date[d]?.notes??"",r=t==="late"||t==="absent";return e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>N(s),className:"p-1",children:e.jsx(de,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"flex items-center gap-2",children:s.document_number&&e.jsxs("span",{className:"text-xs font-medium text-gray-700",children:[s.document_type,": ",s.document_number]})})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{size:"sm",variant:t==="present"?"default":"outline",onClick:()=>v(s.id,"present"),className:`px-2 ${t==="present"?"bg-green-600 hover:bg-green-700":""}`,title:"Presente",children:e.jsx(c,{iconNode:E,className:"w-4 h-4"})}),e.jsx(m,{size:"sm",variant:t==="late"?"default":"outline",onClick:()=>v(s.id,"late"),className:`px-2 ${t==="late"?"bg-yellow-600 hover:bg-yellow-700":""}`,title:"Tarde",children:e.jsx(c,{iconNode:L,className:"w-4 h-4"})}),e.jsx(m,{size:"sm",variant:t==="absent"?"default":"outline",onClick:()=>v(s.id,"absent"),className:`px-2 ${t==="absent"?"bg-red-600 hover:bg-red-700":""}`,title:"Ausente",children:e.jsx(c,{iconNode:z,className:"w-4 h-4"})})]})]}),r&&e.jsx("div",{className:"mt-2 ml-10",children:e.jsx("input",{type:"text",placeholder:t==="late"?"Justificación de tardanza (ej: tráfico, cita médica...)":"Razón de la ausencia...",value:a,onChange:p=>I(s.id,p.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#7a9b3c] focus:border-transparent"})})]},s.id)})}),e.jsx(m,{onClick:V,className:"w-full bg-[#7a9b3c] hover:bg-[#6a8a2c]",disabled:Object.keys(g).length===0,children:"Guardar Asistencia"})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Selecciona una fecha de clase para marcar asistencia"})]})})]})]})}),e.jsx(A,{value:"students",children:e.jsxs(_,{children:[e.jsx(w,{children:e.jsx(C,{children:"Lista de Estudiantes"})}),e.jsx(k,{children:o.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No hay estudiantes inscritos en este grupo"}):e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>N(s),children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[s.document_number&&e.jsxs("span",{className:"font-medium text-gray-700",children:[s.document_type,": ",s.document_number]}),e.jsx("span",{children:s.email})]})]})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-700",children:[s.progress_stats.progress_percentage,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Avance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-700",children:[s.progress_stats.average_grade,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Promedio"})]}),e.jsx(ce,{className:"w-5 h-5 text-gray-400"})]})]},s.id))})})]})}),e.jsx(A,{value:"activities",children:h.length===0?e.jsxs("div",{className:"rounded-xl border-2 border-dashed border-gray-300 bg-white p-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100",children:e.jsx(H,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"mb-2 text-xl font-semibold text-gray-900",children:"No hay actividades configuradas"}),e.jsx("p",{className:"text-gray-600",children:"Este programa aún no tiene actividades para evaluar."})]}):e.jsx("div",{className:"space-y-6",children:R.map((s,t)=>e.jsxs("div",{className:`rounded-xl border bg-white shadow-sm ${s.isLocked?"border-gray-300 opacity-75":"border-gray-200"}`,children:[e.jsxs("div",{className:"p-6 pb-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-lg ${s.isLocked?"bg-gray-200":"bg-blue-100"}`,children:s.isLocked?e.jsx(G,{className:"h-5 w-5 text-gray-500"}):e.jsx(H,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Módulo ",t+1,": ",s.moduleName]}),s.description&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:s.description}),e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-500",children:[s.hours>0&&e.jsxs("span",{children:[s.hours," horas"]}),s.hours>0&&e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Nivel ",s.level]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.activities.length," ",s.activities.length===1?"actividad":"actividades"]})]})]})]}),e.jsx("div",{children:s.isFullyEvaluated?e.jsxs(n,{className:"bg-green-100 text-green-700",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Completado"]}):s.isLocked?e.jsxs(n,{variant:"outline",className:"text-gray-500 border-gray-300",children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),"Bloqueado"]}):e.jsx(n,{className:"bg-amber-100 text-amber-700",children:"Pendiente"})})]}),s.isLocked&&e.jsxs("div",{className:"mt-4 flex items-start gap-3 rounded-lg bg-amber-50 border border-amber-200 p-3",children:[e.jsx(L,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Debes completar la evaluación de todos los estudiantes en los módulos anteriores antes de poder evaluar este módulo."})]})]}),!s.isLocked&&e.jsx("div",{className:"px-6 pb-6",children:e.jsx("div",{className:"ml-14 space-y-3",children:s.activities.map(a=>e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-md bg-purple-100",children:e.jsx(me,{className:"h-4 w-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:a.name}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:a.description}),e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:["Peso: ",a.weight,"%"]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`rounded-full px-2 py-0.5 ${a.is_fully_evaluated?"bg-green-100 text-green-700":a.evaluated_count>0?"bg-amber-100 text-amber-700":"bg-gray-200 text-gray-700"}`,children:a.is_fully_evaluated?"Evaluado":a.evaluated_count>0?`${a.evaluated_count}/${a.total_students} evaluados`:"Sin evaluar"})]})]})]})}),a.evaluation_criteria.length>0&&e.jsxs("div",{className:"ml-11 space-y-2 mb-3",children:[e.jsx("h6",{className:"text-xs font-semibold text-gray-600",children:"Criterios de Evaluación:"}),a.evaluation_criteria.map(r=>e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-gray-200 bg-white p-2",children:[e.jsx(oe,{className:"h-4 w-4 text-amber-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-gray-900 flex-1",children:r.name}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[r.max_points," pts"]})]},r.id))]}),e.jsx("div",{className:"ml-11",children:e.jsx(B,{href:`/profesor/grupo/${i.id}/actividad/${a.id}/evaluar`,children:e.jsx(m,{className:"w-full bg-[#7a9b3c] hover:bg-[#6a8a2c]",children:a.is_fully_evaluated?"Ver / Editar Evaluación":"Evaluar Estudiantes"})})})]},a.id))})})]},s.moduleName))})})]})]}),e.jsx(Y,{open:!!l,onOpenChange:()=>N(null),children:e.jsxs(Z,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ee,{children:[e.jsx(se,{children:l?.name}),e.jsxs(ae,{children:[l?.document_number&&e.jsxs("span",{className:"font-medium text-gray-700 mr-3",children:[l.document_type,": ",l.document_number]}),l?.email]})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Resumen de Asistencia"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.attendance_stats.present}),e.jsx("div",{className:"text-xs text-green-700",children:"Presente"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:l.attendance_stats.late}),e.jsx("div",{className:"text-xs text-yellow-700",children:"Tarde"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.attendance_stats.absent}),e.jsx("div",{className:"text-xs text-red-700",children:"Ausente"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Historial de Asistencias"}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:b.map(s=>{const t=l.attendance_by_date[s.date];return e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[U(t?.status||""),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.day_name}),e.jsx("div",{className:"text-sm text-gray-500",children:j(s.date)})]})]}),q(t?.status||"")]}),t?.notes&&e.jsxs("div",{className:"mt-2 ml-7 text-sm text-gray-600 bg-gray-50 rounded p-2",children:[e.jsx("span",{className:"font-medium",children:"Nota: "}),t.notes]})]},s.date)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Avance Académico"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600",children:"Progreso"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-700",children:[l.progress_stats.progress_percentage,"%"]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[l.progress_stats.evaluated_activities," de ",l.progress_stats.total_activities," actividades"]})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600",children:"Promedio"}),e.jsxs("div",{className:"text-3xl font-bold text-green-700",children:[l.progress_stats.average_grade,"%"]}),e.jsx("div",{className:"text-xs text-green-600",children:"Calificación general"})]})]})]})]})]})})]})}export{Ye as default};
