import{j as e,r as n,F as g,H as k}from"./app-DQdfAIrT.js";import{H as T}from"./heading-small-Bu3JQH69.js";import{B as p}from"./button-VerjejBs.js";import{C as A,b as _,c as F,d as z,a as M}from"./card-xa_nu3wW.js";import{c as V,d as D,b as I,e as R,f as H}from"./index-DmHkLzld.js";import{c as O}from"./index-CdJFUDDL.js";import{c as b}from"./utils-CBfrqCZ4.js";import{C as E}from"./circle-alert-DHtWShsh.js";import{c as h}from"./createLucideIcon-FBGZZ2XP.js";import{E as L}from"./eye-off-BsUIHrLD.js";import{E as B}from"./eye-jtjOBm3q.js";import{R as P}from"./refresh-cw-Bte9bIjD.js";import{I as $}from"./input-error-BnQfg6Ld.js";import{D as G,a as q,b as K,c as Q,d as X}from"./dialog-Cz5AvGta.js";import{I as J,K as U,O as j,a as W,b as Y,u as Z}from"./use-two-factor-auth-BVoutlQu.js";import{L as y}from"./loader-circle-BunfddH-.js";import{C as ee}from"./check-Bw5X6T2g.js";import{B as N}from"./badge-D23JO_t_.js";import{A as te}from"./app-layout-4clgNQ85.js";import{S as ae}from"./layout-Y4eSnFj4.js";import"./app-C-cf51TB.js";import"./index-C7yH7irC.js";import"./wayfinder-Bf9OnZdi.js";import"./app-header-BJ6Qh71R.js";import"./chevron-right-Bj574-qT.js";import"./index-CfWGIfzM.js";import"./index-DgJsnbTO.js";import"./index-C47Lcm81.js";import"./index-IgmI3j8n.js";import"./index-BzC76F-K.js";import"./index-Q9OWOLmH.js";import"./index-BGHOW37F.js";import"./index-DvImgo4L.js";import"./graduation-cap-BqNDqZIZ.js";import"./users-D1XkPNsH.js";import"./credit-card-BIFgk_mu.js";import"./calendar-YX0MwFSw.js";import"./file-text-CdhlA8Sa.js";import"./lock-Bhi6MTHY.js";import"./shield-DJVllbGN.js";import"./mail-C6vpu2CA.js";import"./toaster-B_zTenYs.js";import"./heading-CxiBdtUP.js";import"./index-BbeadLAU.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],re=h("Copy",se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]],ne=h("LockKeyhole",ie);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],oe=h("ScanLine",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m4.243 5.21 14.39 12.472",key:"1c9a7c"}]],de=h("ShieldBan",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],C=h("ShieldCheck",ue),me=O("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"text-destructive-foreground [&>svg]:text-current *:data-[slot=alert-description]:text-destructive-foreground/80"}},defaultVariants:{variant:"default"}});function pe({className:a,variant:t,...r}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:b(me({variant:t}),a),...r})}function xe({className:a,...t}){return e.jsx("div",{"data-slot":"alert-title",className:b("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",a),...t})}function fe({className:a,...t}){return e.jsx("div",{"data-slot":"alert-description",className:b("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",a),...t})}function w({errors:a,title:t}){return e.jsxs(pe,{variant:"destructive",children:[e.jsx(E,{}),e.jsx(xe,{children:t||"Algo salió mal."}),e.jsx(fe,{children:e.jsx("ul",{className:"list-inside list-disc text-sm",children:Array.from(new Set(a)).map((r,s)=>e.jsx("li",{children:r},s))})})]})}function he({recoveryCodesList:a,fetchRecoveryCodes:t,errors:r}){const[s,i]=n.useState(!1),c=n.useRef(null),o=a.length>0&&s,d=n.useCallback(async()=>{!s&&!a.length&&await t(),i(!s),s||setTimeout(()=>{c.current?.scrollIntoView({behavior:"smooth",block:"nearest"})})},[s,a.length,t]);n.useEffect(()=>{a.length||t()},[a.length,t]);const m=s?L:B;return e.jsxs(A,{children:[e.jsxs(_,{children:[e.jsxs(F,{className:"flex gap-3",children:[e.jsx(ne,{className:"size-4","aria-hidden":"true"}),"Códigos de Recuperación 2FA"]}),e.jsx(z,{children:"Los códigos de recuperación te permiten recuperar el acceso si pierdes tu dispositivo 2FA. Guárdalos en un gestor de contraseñas seguro."})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex flex-col gap-3 select-none sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(p,{onClick:d,className:"w-fit","aria-expanded":s,"aria-controls":"recovery-codes-section",children:[e.jsx(m,{className:"size-4","aria-hidden":"true"}),s?"Ocultar":"Ver"," Códigos de Recuperación"]}),o&&e.jsx(g,{...V.form(),options:{preserveScroll:!0},onSuccess:t,children:({processing:l})=>e.jsxs(p,{variant:"secondary",type:"submit",disabled:l,"aria-describedby":"regenerate-warning",children:[e.jsx(P,{})," Regenerar Códigos"]})})]}),e.jsx("div",{id:"recovery-codes-section",className:`relative overflow-hidden transition-all duration-300 ${s?"h-auto opacity-100":"h-0 opacity-0"}`,"aria-hidden":!s,children:e.jsx("div",{className:"mt-3 space-y-3",children:r?.length?e.jsx(w,{errors:r}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:c,className:"grid gap-1 rounded-lg bg-muted p-4 font-mono text-sm",role:"list","aria-label":"Códigos de recuperación",children:a.length?a.map((l,u)=>e.jsx("div",{role:"listitem",className:"select-text",children:l},u)):e.jsx("div",{className:"space-y-2","aria-label":"Cargando códigos de recuperación",children:Array.from({length:8},(l,u)=>e.jsx("div",{className:"h-4 animate-pulse rounded bg-muted-foreground/20","aria-hidden":"true"},u))})}),e.jsx("div",{className:"text-xs text-muted-foreground select-none",children:e.jsxs("p",{id:"regenerate-warning",children:["Cada código de recuperación puede ser usado una vez para acceder a tu cuenta y será eliminado después de su uso. Si necesitas más, haz clic en"," ",e.jsx("span",{className:"font-bold",children:"Regenerar Códigos"})," ","arriba."]})})]})})})]})]})}function ge(){const[a,t]=n.useState(null),r=n.useCallback(async s=>{if(!navigator?.clipboard)return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(s),t(s),!0}catch(i){return console.warn("Copy failed",i),t(null),!1}},[]);return[a,r]}function je(){return e.jsx("div",{className:"mb-3 rounded-full border border-border bg-card p-0.5 shadow-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-full border border-border bg-muted p-2.5",children:[e.jsx("div",{className:"absolute inset-0 grid grid-cols-5 opacity-50",children:Array.from({length:5},(a,t)=>e.jsx("div",{className:"border-r border-border last:border-r-0"},`col-${t+1}`))}),e.jsx("div",{className:"absolute inset-0 grid grid-rows-5 opacity-50",children:Array.from({length:5},(a,t)=>e.jsx("div",{className:"border-b border-border last:border-b-0"},`row-${t+1}`))}),e.jsx(oe,{className:"relative z-20 size-6 text-foreground"})]})})}function be({qrCodeSvg:a,manualSetupKey:t,buttonText:r,onNextStep:s,errors:i}){const[c,o]=ge(),d=c===t?ee:re;return e.jsx(e.Fragment,{children:i?.length?e.jsx(w,{errors:i}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex max-w-md overflow-hidden",children:e.jsx("div",{className:"mx-auto aspect-square w-64 rounded-lg border border-border",children:e.jsx("div",{className:"z-10 flex h-full w-full items-center justify-center p-5",children:a?e.jsx("div",{dangerouslySetInnerHTML:{__html:a}}):e.jsx(y,{className:"flex size-4 animate-spin"})})})}),e.jsx("div",{className:"flex w-full space-x-5",children:e.jsx(p,{className:"w-full",onClick:s,children:r})}),e.jsxs("div",{className:"relative flex w-full items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 top-1/2 h-px w-full bg-border"}),e.jsx("span",{className:"relative bg-card px-2 py-1",children:"o ingresa el código manualmente"})]}),e.jsx("div",{className:"flex w-full space-x-2",children:e.jsx("div",{className:"flex w-full items-stretch overflow-hidden rounded-xl border border-border",children:t?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",readOnly:!0,value:t,className:"h-full w-full bg-background p-3 text-foreground outline-none"}),e.jsx("button",{onClick:()=>o(t),className:"border-l border-border px-3 hover:bg-muted",children:e.jsx(d,{className:"w-4"})})]}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted p-3",children:e.jsx(y,{className:"size-4 animate-spin"})})})})]})})}function ve({onClose:a,onBack:t}){const[r,s]=n.useState(""),i=n.useRef(null);return n.useEffect(()=>{setTimeout(()=>{i.current?.querySelector("input")?.focus()},0)},[]),e.jsx(g,{...D.form(),onSuccess:()=>a(),resetOnError:!0,resetOnSuccess:!0,children:({processing:c,errors:o})=>e.jsx(e.Fragment,{children:e.jsxs("div",{ref:i,className:"relative w-full space-y-3",children:[e.jsxs("div",{className:"flex w-full flex-col items-center space-y-3 py-2",children:[e.jsx(J,{id:"otp",name:"code",maxLength:j,onChange:s,disabled:c,pattern:U,children:e.jsx(W,{children:Array.from({length:j},(d,m)=>e.jsx(Y,{index:m},m))})}),e.jsx($,{message:o?.confirmTwoFactorAuthentication?.code})]}),e.jsxs("div",{className:"flex w-full space-x-5",children:[e.jsx(p,{type:"button",variant:"outline",className:"flex-1",onClick:t,disabled:c,children:"Atrás"}),e.jsx(p,{type:"submit",className:"flex-1",disabled:c||r.length<j,children:"Confirmar"})]})]})})})}function ye({isOpen:a,onClose:t,requiresConfirmation:r,twoFactorEnabled:s,qrCodeSvg:i,manualSetupKey:c,clearSetupData:o,fetchSetupData:d,errors:m}){const[l,u]=n.useState(!1),x=n.useMemo(()=>s?{title:"Autenticación de Dos Factores Habilitada",description:"La autenticación de dos factores ahora está habilitada. Escanea el código QR o ingresa la clave de configuración en tu aplicación de autenticación.",buttonText:"Cerrar"}:l?{title:"Verificar Código de Autenticación",description:"Ingresa el código de 6 dígitos de tu aplicación de autenticación",buttonText:"Continuar"}:{title:"Habilitar Autenticación de Dos Factores",description:"Para finalizar la habilitación de la autenticación de dos factores, escanea el código QR o ingresa la clave de configuración en tu aplicación de autenticación",buttonText:"Continuar"},[s,l]),f=n.useCallback(()=>{if(r){u(!0);return}o(),t()},[r,o,t]),v=n.useCallback(()=>{u(!1),s&&o()},[s,o]);return n.useEffect(()=>{if(!a){v();return}i||d()},[a,i,d,v]),e.jsx(G,{open:a,onOpenChange:S=>!S&&t(),children:e.jsxs(q,{className:"sm:max-w-md",children:[e.jsxs(K,{className:"flex items-center justify-center",children:[e.jsx(je,{}),e.jsx(Q,{children:x.title}),e.jsx(X,{className:"text-center",children:x.description})]}),e.jsx("div",{className:"flex flex-col items-center space-y-5",children:l?e.jsx(ve,{onClose:t,onBack:()=>u(!1)}):e.jsx(be,{qrCodeSvg:i,manualSetupKey:c,buttonText:x.buttonText,onNextStep:f,errors:m})})]})})}const Ne=[{title:"Autenticación de Dos Factores",href:I.url()}];function pt({requiresConfirmation:a=!1,twoFactorEnabled:t=!1}){const{qrCodeSvg:r,hasSetupData:s,manualSetupKey:i,clearSetupData:c,fetchSetupData:o,recoveryCodesList:d,fetchRecoveryCodes:m,errors:l}=Z(),[u,x]=n.useState(!1);return e.jsxs(te,{breadcrumbs:Ne,children:[e.jsx(k,{title:"Autenticación de Dos Factores"}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{title:"Autenticación de Dos Factores",description:"Administra la configuración de autenticación de dos factores"}),t?e.jsxs("div",{className:"flex flex-col items-start justify-start space-y-4",children:[e.jsx(N,{variant:"default",children:"Habilitada"}),e.jsx("p",{className:"text-muted-foreground",children:"Con la autenticación de dos factores habilitada, se te solicitará un código seguro y aleatorio durante el inicio de sesión, el cual puedes obtener desde la aplicación compatible con TOTP en tu teléfono."}),e.jsx(he,{recoveryCodesList:d,fetchRecoveryCodes:m,errors:l}),e.jsx("div",{className:"relative inline",children:e.jsx(g,{...R.form(),children:({processing:f})=>e.jsxs(p,{variant:"destructive",type:"submit",disabled:f,children:[e.jsx(de,{})," Deshabilitar 2FA"]})})})]}):e.jsxs("div",{className:"flex flex-col items-start justify-start space-y-4",children:[e.jsx(N,{variant:"destructive",children:"Deshabilitada"}),e.jsx("p",{className:"text-muted-foreground",children:"Cuando habilites la autenticación de dos factores, se te solicitará un código seguro durante el inicio de sesión. Este código puede obtenerse desde una aplicación compatible con TOTP en tu teléfono."}),e.jsx("div",{children:s?e.jsxs(p,{onClick:()=>x(!0),children:[e.jsx(C,{}),"Continuar Configuración"]}):e.jsx(g,{...H.form(),onSuccess:()=>x(!0),children:({processing:f})=>e.jsxs(p,{type:"submit",disabled:f,children:[e.jsx(C,{}),"Habilitar 2FA"]})})})]}),e.jsx(ye,{isOpen:u,onClose:()=>x(!1),requiresConfirmation:a,twoFactorEnabled:t,qrCodeSvg:r,manualSetupKey:i,clearSetupData:c,fetchSetupData:o,errors:l})]})})]})}export{pt as default};
