import{r as x,u as O,j as e,H as $,L as A,a as q}from"./app-D720TaZI.js";import{B as h}from"./button-DTndidD-.js";import{I as l}from"./input-DZl8FfGZ.js";import{L as r}from"./label-DN54Xbnq.js";import{T as B}from"./textarea-CguF6yEY.js";import{A as I}from"./app-layout-C4FSMOBz.js";import{I as i}from"./input-error-CL_RpYPa.js";import{A as H}from"./arrow-left-z1B-m-Mg.js";import{D as V}from"./dollar-sign-DKoZcoeX.js";import{R as z}from"./receipt-BzW0Hjnm.js";import{P as G}from"./plus-B4SJkf_G.js";import{C as v}from"./check-D2kXCGPw.js";import{S as Y}from"./app-header-vikwbJch.js";import{S as J}from"./save-DrmFwqfF.js";/* empty css            */import"./utils-DmkSgyWg.js";import"./index-GLpayk7y.js";import"./index-DLllxVLY.js";import"./index-BLOBkqYP.js";import"./index-D2YKrHzH.js";import"./index-BWfE0pDH.js";import"./createLucideIcon-DigUFbuC.js";import"./index-Dkc4isJQ.js";import"./toaster-CJPkqyoj.js";import"./chevron-right-Dk-laIOK.js";import"./index-C5M1fw6K.js";import"./index-CLa6oRL-.js";import"./wayfinder-Bf9OnZdi.js";import"./index-D12nj1Ca.js";import"./book-open-BpmjL7wC.js";import"./graduation-cap-jnrT4xS4.js";import"./users-CA7DN7ey.js";import"./credit-card-DETocYyF.js";import"./calendar-BGhziAFb.js";import"./file-text-DYVWjvgD.js";import"./lock-C6Oi9uBw.js";import"./shield-FiGpr67-.js";import"./chevron-down-BCN9SoXG.js";import"./loader-circle-D86hfN0t.js";import"./mail-BBkbB-Pa.js";const K={cash:"Efectivo",transfer:"Transferencia",credit_card:"Tarjeta de Crédito"};function Re({payment:s,enrollments:N}){const[c,_]=x.useState(""),[m,C]=x.useState(s?.enrollment_id&&N.find(t=>t.id===s.enrollment_id)||null),[F,j]=x.useState(!1),[d,u]=x.useState({amount:"",payment_method:"cash",reference_number:"",notes:""}),[w,f]=x.useState(!1),{data:a,setData:o,post:E,put:L,processing:y,errors:n}=O({student_id:s?.student_id||"",program_id:s?.program_id||"",enrollment_id:s?.enrollment_id||"",concept:s?.concept||"",payment_type:s?.payment_type||"single",amount:s?.amount||"",due_date:s?.due_date||"",status:s?.status||"pending",payment_method:s?.payment_method||"",reference_number:s?.reference_number||"",notes:s?.notes||""}),T=t=>{C(t),_(""),o({...a,student_id:t.student_id,program_id:t.program_id,enrollment_id:t.id})},M=t=>{t.preventDefault(),s?.id?L(`/pagos/${s.id}`):E("/pagos")},R=t=>{t.preventDefault(),s?.id&&(f(!0),q.post(`/pagos/${s.id}/add-transaction`,d,{onSuccess:()=>{u({amount:"",payment_method:"cash",reference_number:"",notes:""}),j(!1),f(!1)},onError:()=>{f(!1)}}))},S=N.filter(t=>t.student_name.toLowerCase().includes(c.toLowerCase())||t.student_email.toLowerCase().includes(c.toLowerCase())||t.program_name.toLowerCase().includes(c.toLowerCase())),k=!!s?.id,g=s?.amount??0,b=s?.paid_amount??0,p=s?.pending_balance??s?.remaining_amount??g,P=g>0?Math.min(b/g*100,100):0,D=k&&s?.status!=="completed"&&s?.status!=="cancelled"&&p>0;return e.jsxs(I,{children:[e.jsx($,{title:s?"Editar Pago":"Registrar Pago"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(A,{href:"/pagos",className:"mb-2 flex items-center text-sm text-muted-foreground hover:text-foreground",children:[e.jsx(H,{className:"mr-1 h-4 w-4"}),"Volver a pagos"]}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:s?"Editar Pago":"Registrar Pago"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Selecciona un estudiante inscrito para registrar el pago"})]})}),D&&e.jsxs("div",{className:"rounded-xl border border-border bg-card p-6 shadow-sm",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(V,{className:"h-5 w-5 text-green-600"}),"Sistema de Abonos"]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progreso de pago"}),e.jsxs("span",{className:"font-medium text-foreground",children:[P.toFixed(0),"%"]})]}),e.jsx("div",{className:"mt-2 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-green-500 transition-all",style:{width:`${P}%`}})}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-4 text-center text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Total"}),e.jsxs("div",{className:"font-semibold text-foreground",children:["$",g.toLocaleString("es-CO")]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Pagado"}),e.jsxs("div",{className:"font-semibold text-green-600",children:["$",b.toLocaleString("es-CO")]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Pendiente"}),e.jsxs("div",{className:"font-semibold text-orange-600",children:["$",p.toLocaleString("es-CO")]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(z,{className:"h-4 w-4"}),"Historial de Abonos"]}),s.transactions&&s.transactions.length>0?e.jsx("div",{className:"mt-3 overflow-hidden rounded-lg border border-border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-muted-foreground",children:"Fecha"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-muted-foreground",children:"Monto"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-muted-foreground",children:"Método"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-muted-foreground",children:"Referencia"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-muted-foreground",children:"Notas"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:s.transactions.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-muted-foreground",children:new Date(t.created_at).toLocaleDateString("es-CO")}),e.jsxs("td",{className:"px-4 py-2 font-medium text-green-700 dark:text-green-300",children:["$",Number(t.amount).toLocaleString("es-CO")]}),e.jsx("td",{className:"px-4 py-2 text-muted-foreground",children:K[t.payment_method]??t.payment_method}),e.jsx("td",{className:"px-4 py-2 text-muted-foreground",children:t.reference_number||"—"}),e.jsx("td",{className:"px-4 py-2 text-muted-foreground",children:t.notes||"—"})]},t.id))})]})}):e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:"No hay abonos registrados aún."})]}),F?e.jsxs("form",{onSubmit:R,className:"mt-4 rounded-lg border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/30 p-4",children:[e.jsx("h4",{className:"mb-3 font-medium text-green-900 dark:text-green-100",children:"Nuevo Abono"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"abono_amount",children:"Monto *"}),e.jsx(l,{id:"abono_amount",type:"number",step:"1",min:"1",max:p,value:d.amount,onChange:t=>u({...d,amount:t.target.value}),placeholder:`Máx: $${p.toLocaleString("es-CO")}`,required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"abono_method",children:"Método de Pago *"}),e.jsxs("select",{id:"abono_method",value:d.payment_method,onChange:t=>u({...d,payment_method:t.target.value}),className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",required:!0,children:[e.jsx("option",{value:"cash",children:"Efectivo"}),e.jsx("option",{value:"transfer",children:"Transferencia"}),e.jsx("option",{value:"credit_card",children:"Tarjeta de Crédito"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"abono_reference",children:"Número de Referencia"}),e.jsx(l,{id:"abono_reference",type:"text",value:d.reference_number,onChange:t=>u({...d,reference_number:t.target.value}),placeholder:"Comprobante"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"abono_notes",children:"Notas"}),e.jsx(l,{id:"abono_notes",type:"text",value:d.notes,onChange:t=>u({...d,notes:t.target.value}),placeholder:"Observaciones"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(h,{type:"submit",disabled:w,children:w?"Registrando...":"Registrar Abono"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancelar"})]})]}):e.jsxs(h,{type:"button",onClick:()=>j(!0),className:"mt-4",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Agregar Abono"]})]}),k&&s?.status==="completed"&&s.transactions&&s.transactions.length>0&&e.jsxs("div",{className:"rounded-xl border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/30 p-6 shadow-sm",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-lg font-semibold text-green-800 dark:text-green-200",children:[e.jsx(v,{className:"h-5 w-5"}),"Pago Completado"]}),e.jsxs("p",{className:"mt-1 text-sm text-green-700 dark:text-green-300",children:["Total pagado: $",b.toLocaleString("es-CO")," en ",s.transactions.length," abono(s)"]})]}),e.jsxs("form",{onSubmit:M,className:"rounded-xl border border-border bg-card p-6 shadow-sm",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"student-search",children:"Buscar Estudiante Inscrito *"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(l,{id:"student-search",type:"text",value:c,onChange:t=>_(t.target.value),placeholder:"Buscar por nombre, email o programa...",className:"pl-10"})]}),c&&e.jsx("div",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md border border-border bg-card shadow-lg",children:S.length>0?S.map(t=>e.jsxs("button",{type:"button",onClick:()=>T(t),className:"flex w-full items-start gap-3 px-4 py-3 text-left hover:bg-muted",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-foreground",children:t.student_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.student_email}),e.jsx("div",{className:"mt-1 inline-flex items-center rounded-full bg-blue-100 dark:bg-blue-900/30 px-2 py-0.5 text-xs font-medium text-blue-700 dark:text-blue-400",children:t.program_name})]}),m?.id===t.id&&e.jsx(v,{className:"h-5 w-5 text-green-600"})]},t.id)):e.jsx("div",{className:"px-4 py-3 text-sm text-muted-foreground",children:"No se encontraron estudiantes inscritos"})}),m&&!c&&e.jsx("div",{className:"mt-2 rounded-lg border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950/30 p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 dark:text-green-100",children:m.student_name})]}),e.jsxs("div",{className:"ml-6 mt-1 text-sm text-green-700 dark:text-green-300",children:["Programa: ",m.program_name]})]}),e.jsx("button",{type:"button",onClick:()=>{C(null),o({...a,student_id:"",program_id:"",enrollment_id:""})},className:"text-sm text-green-700 dark:text-green-300 hover:text-green-900 dark:text-green-100",children:"Cambiar"})]})})]}),e.jsx(i,{message:n.student_id||n.enrollment_id})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"concept",children:"Concepto del Pago *"}),e.jsx(l,{id:"concept",type:"text",value:a.concept,onChange:t=>o("concept",t.target.value),placeholder:"Ej: Mensualidad Enero 2025",required:!0}),e.jsx(i,{message:n.concept})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"payment_type",children:"Tipo de Pago *"}),e.jsxs("select",{id:"payment_type",value:a.payment_type,onChange:t=>o("payment_type",t.target.value),className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",children:[e.jsx("option",{value:"single",children:"Pago Único"}),e.jsx("option",{value:"partial",children:"Permite Abonos Parciales"})]}),e.jsx(i,{message:n.payment_type})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"amount",children:"Monto *"}),e.jsx(l,{id:"amount",type:"number",step:"0.01",value:a.amount,onChange:t=>o("amount",t.target.value),placeholder:"0.00",required:!0}),e.jsx(i,{message:n.amount})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"due_date",children:"Fecha de Vencimiento *"}),e.jsx(l,{id:"due_date",type:"date",value:a.due_date,onChange:t=>o("due_date",t.target.value),required:!0}),e.jsx(i,{message:n.due_date})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"status",children:"Estado *"}),e.jsxs("select",{id:"status",value:a.status,onChange:t=>o("status",t.target.value),className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",children:[e.jsx("option",{value:"pending",children:"Pendiente"}),e.jsx("option",{value:"completed",children:"Completado"}),e.jsx("option",{value:"overdue",children:"Vencido"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]}),e.jsx(i,{message:n.status})]}),a.status==="completed"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"payment_method",children:"Método de Pago"}),e.jsxs("select",{id:"payment_method",value:a.payment_method,onChange:t=>o("payment_method",t.target.value),className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",children:[e.jsx("option",{value:"",children:"Seleccionar"}),e.jsx("option",{value:"cash",children:"Efectivo"}),e.jsx("option",{value:"transfer",children:"Transferencia"}),e.jsx("option",{value:"credit_card",children:"Tarjeta de Crédito"})]}),e.jsx(i,{message:n.payment_method})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"reference_number",children:"Número de Referencia"}),e.jsx(l,{id:"reference_number",type:"text",value:a.reference_number,onChange:t=>o("reference_number",t.target.value),placeholder:"Número de comprobante"}),e.jsx(i,{message:n.reference_number})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(r,{htmlFor:"notes",children:"Notas"}),e.jsx(B,{id:"notes",value:a.notes,onChange:t=>o("notes",t.target.value),placeholder:"Observaciones adicionales...",rows:3}),e.jsx(i,{message:n.notes})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx(A,{href:"/pagos",children:e.jsx(h,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsxs(h,{type:"submit",disabled:y||!m,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),y?"Guardando...":s?"Actualizar Pago":"Registrar Pago"]})]})]})]})]})}export{Re as default};
