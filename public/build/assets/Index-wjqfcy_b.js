import{r as n,u as E,a as N,j as e,H as B}from"./app-C_wc9es_.js";import{A as M}from"./app-layout-RCkHY00m.js";import{B as d}from"./button-CK7_c_5e.js";import{C as H,b as Q,c as A,d as O,a as U}from"./card-qYJq1A3u.js";import{D as F,e as P,a as $,b as q,c as z,d as R}from"./dialog-CZ2QG5Ox.js";import{I as v}from"./input-C7PQsbVn.js";import{s as w}from"./index-ikzcNs2d.js";import{P as G}from"./plus-CQpr_2NB.js";import{S as y,M as J}from"./app-header-3tM_PALz.js";/* empty css            */import"./utils-BTwnVSy2.js";import"./index-myZmSymV.js";import"./index-Be2p5AN3.js";import"./createLucideIcon-Cl_h1Hpc.js";import"./index-BPZo39PE.js";import"./index-DJBO6EKN.js";import"./index-BLRCw3fc.js";import"./toaster-eRoXJvOx.js";import"./index-CNhhqjg2.js";import"./chevron-right-FEguOG6w.js";import"./index-BXFwRZdy.js";import"./index-CLa6oRL-.js";import"./wayfinder-Bf9OnZdi.js";import"./index-D12nj1Ca.js";import"./book-open-DgLAYnVa.js";import"./graduation-cap-DpEnpuH4.js";import"./users-BlXHteJc.js";import"./credit-card-Cyqos1IL.js";import"./calendar-CdY4SBhE.js";import"./file-text-BcV-VVC0.js";import"./lock-l4QBdaDv.js";import"./shield-Dk7fcTnH.js";import"./chevron-down-D4MJa3Wh.js";import"./loader-circle-DIXjFJg0.js";import"./mail-jATxNgrm.js";function Te({conversations:t,availableUsers:u}){const[b,x]=n.useState(!1),[o,C]=n.useState(""),[a,l]=n.useState(""),{data:h,setData:p,post:_,processing:S,errors:f,reset:g}=E({user_id:""}),D=s=>{s.preventDefault(),_(w("comunicacion.start"),{onSuccess:()=>{g(),x(!1)}})},L=s=>{if(!s)return"";const r=new Date(s),k=new Date().getTime()-r.getTime(),m=Math.floor(k/(1e3*60*60*24));return m===0?r.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):m===1?"Ayer":m<7?r.toLocaleDateString("es-ES",{weekday:"short"}):r.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"})},I=(s,r=50)=>s.length<=r?s:s.substring(0,r)+"...",c=t.filter(s=>s.other_user?.name.toLowerCase().includes(o.toLowerCase())||s.other_user?.email.toLowerCase().includes(o.toLowerCase())),j=u.filter(s=>s.name.toLowerCase().includes(a.toLowerCase())||s.email.toLowerCase().includes(a.toLowerCase())),i=u.find(s=>s.id.toString()===h.user_id),T=s=>{x(s),s||(l(""),g())};return n.useEffect(()=>{const s=setInterval(()=>{N.reload({only:["conversations"],preserveScroll:!0,preserveState:!0})},5e3);return()=>clearInterval(s)},[]),e.jsxs(M,{children:[e.jsx(B,{title:"Comunicaciones"}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground sm:text-3xl",children:"Comunicaciones"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground sm:mt-2 sm:text-base",children:"Conversa con otros usuarios del sistema"})]}),e.jsxs(F,{open:b,onOpenChange:T,children:[e.jsx(P,{asChild:!0,children:e.jsxs(d,{className:"w-full sm:w-auto",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"sm:inline",children:"Nueva conversación"})]})}),e.jsxs($,{className:"max-h-[90vh] overflow-hidden sm:max-w-md",children:[e.jsxs(q,{children:[e.jsx(z,{children:"Iniciar nueva conversación"}),e.jsx(R,{children:"Busca y selecciona un usuario"})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(v,{type:"text",placeholder:"Buscar por nombre o email...",value:a,onChange:s=>l(s.target.value),className:"pl-10",autoFocus:!0})]}),i&&e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary bg-primary/5 p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate font-medium text-sm",children:i.name}),e.jsx("p",{className:"truncate text-xs text-muted-foreground",children:i.email})]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>p("user_id",""),className:"ml-2 shrink-0 text-xs",children:"Cambiar"})]}),!i&&e.jsx("div",{className:"max-h-[40vh] overflow-y-auto rounded-lg border",children:j.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:a?"No se encontraron usuarios":"No hay usuarios disponibles"}):e.jsx("div",{className:"divide-y",children:j.map(s=>e.jsxs("button",{type:"button",onClick:()=>{p("user_id",s.id.toString()),l("")},className:"w-full p-3 text-left transition-colors hover:bg-accent",children:[e.jsx("p",{className:"truncate font-medium text-sm",children:s.name}),e.jsx("p",{className:"truncate text-xs text-muted-foreground",children:s.email})]},s.id))})}),f.user_id&&e.jsx("p",{className:"text-sm text-destructive",children:f.user_id})]}),e.jsx(d,{type:"submit",disabled:S||!h.user_id,className:"w-full",children:"Iniciar conversación"})]})]})]})]}),e.jsxs(H,{children:[e.jsxs(Q,{children:[e.jsx(A,{children:"Tus conversaciones"}),e.jsx(O,{children:t.length===0?"No tienes conversaciones activas":`${t.length} conversación${t.length!==1?"es":""}`})]}),e.jsxs(U,{children:[t.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(v,{type:"text",placeholder:"Buscar conversaciones...",value:o,onChange:s=>C(s.target.value),className:"pl-10"})]})}),c.length===0&&t.length>0&&e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No se encontraron conversaciones"}),c.length===0&&t.length===0&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"No tienes conversaciones aún"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inicia una nueva conversación con el botón de arriba"})]}),e.jsx("div",{className:"space-y-2",children:c.map(s=>e.jsx("button",{onClick:()=>N.visit(w("comunicacion.show",{conversation:s.id})),className:"w-full rounded-lg border p-3 text-left transition-colors hover:bg-accent sm:p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1",children:[e.jsx("h3",{className:"truncate font-semibold text-sm sm:text-base",children:s.other_user?.name||"Usuario desconocido"}),s.last_message_at&&e.jsx("span",{className:"shrink-0 text-xs text-muted-foreground",children:L(s.last_message_at)})]}),e.jsx("p",{className:"truncate text-xs text-muted-foreground sm:text-sm",children:s.other_user?.email}),s.latest_message&&e.jsxs("p",{className:"mt-1 truncate text-xs text-muted-foreground sm:text-sm",children:[s.latest_message.is_mine&&"Tú: ",I(s.latest_message.body)]})]}),s.unread_count>0&&e.jsx("div",{className:"ml-2 flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-medium text-primary-foreground sm:ml-4 sm:h-6 sm:w-6",children:s.unread_count})]})},s.id))})]})]})]})]})}export{Te as default};
