import{r as x,j as e,H as J,L as B,a as X}from"./app-_rOQn_46.js";import{A as K}from"./app-layout-CLhCFhGY.js";import{B as o}from"./button-Cwjg0RKq.js";import{C as y,b as w,c as k,d as F,a as C}from"./card-BBOBQJet.js";import{B as n}from"./badge-CxkKJAJ8.js";import{T as Q,a as W,b as S,c as A}from"./tabs-BL5OaBBa.js";import{D as Y,a as Z,b as ee,c as se,d as ae}from"./dialog-DY_ZgsD6.js";import{I as c}from"./app-header-uhUDMoS0.js";import{C as M}from"./clock-92yNzH6p.js";import{M as te}from"./map-pin-DJgFki66.js";import{C as re}from"./clipboard-check-zUHCUVQw.js";import{U as de}from"./users-CU2UoBYp.js";import{G as le}from"./graduation-cap-h2z_kizA.js";import{C as ne}from"./calendar-DwYwQP4N.js";import{E as ie}from"./eye-HnW50b-k.js";import{C as E}from"./circle-check-big-DVR_8QDl.js";import{C as L}from"./circle-alert-DSwOrkeA.js";import{C as z}from"./circle-x-C2egA9mx.js";import{C as ce}from"./chevron-right-KvpbVvzH.js";import{B as H,L as oe}from"./list-checks-BLF9I54Z.js";import{L as G}from"./lock-BoKNE-VZ.js";import{A as me}from"./book-open-d3nfV-Db.js";/* empty css            */import"./utils-CHYGzkwl.js";import"./index-kZXzX9CC.js";import"./index-C0WYYgI1.js";import"./createLucideIcon-BTUecZaa.js";import"./index-DhMGY2fr.js";import"./index-LDKjRhno.js";import"./index-86eqSqYr.js";import"./toaster-DF114ULM.js";import"./index-HbNiKBAr.js";import"./index-B4ow9L1E.js";import"./index-CLa6oRL-.js";import"./wayfinder-Bf9OnZdi.js";import"./index-D12nj1Ca.js";import"./credit-card-CtYZ3YyT.js";import"./file-text-CqZet-U8.js";import"./shield-DI4dg6mj.js";import"./chevron-down-gmsC21Id.js";import"./loader-circle-eUOhA3c_.js";import"./mail-DuzhTNEq.js";function es({schedule:l,students:m,activities:u,classDates:P}){const[p,$]=x.useState({}),[T,g]=x.useState({}),[i,O]=x.useState(null),[d,f]=x.useState(null),R=x.useMemo(()=>{const s={};u.forEach(a=>{const r=a.study_plan.module_name;s[r]||(s[r]={moduleName:a.study_plan.module_name,description:a.study_plan.description,hours:a.study_plan.hours??0,level:a.study_plan.level??0,activities:[],isFullyEvaluated:!0}),s[r].activities.push(a),a.is_fully_evaluated||(s[r].isFullyEvaluated=!1)});const t=Object.values(s).sort((a,r)=>a.level-r.level||a.moduleName.localeCompare(r.moduleName));return t.map((a,r)=>{let j=!1;if(r>0){for(let _=0;_<r;_++)if(!t[_].isFullyEvaluated){j=!0;break}}return{...a,isLocked:j}})},[u]),D=s=>{O(s);const t={},a={};m.forEach(r=>{r.attendance_by_date[s]&&(t[r.id]=r.attendance_by_date[s].status,a[r.id]=r.attendance_by_date[s].notes||"")}),$(t),g(a)},b=(s,t)=>{$(a=>({...a,[s]:t})),t==="present"&&g(a=>({...a,[s]:""}))},I=(s,t)=>{g(a=>({...a,[s]:t}))},V=()=>{if(!i)return;const s=Object.entries(p).map(([t,a])=>({student_id:parseInt(t),status:a,notes:T[parseInt(t)]||""}));if(s.length===0){alert("Debes marcar al menos un estudiante");return}X.post(`/profesor/grupo/${l.id}/asistencia`,{class_date:i,attendances:s})},U=s=>{switch(s){case"present":return e.jsx(E,{className:"w-4 h-4 text-green-500"});case"late":return e.jsx(L,{className:"w-4 h-4 text-yellow-500"});case"absent":return e.jsx(z,{className:"w-4 h-4 text-red-500"});default:return e.jsx(M,{className:"w-4 h-4 text-muted-foreground"})}},q=s=>{switch(s){case"present":return e.jsx(n,{className:"bg-green-500",children:"Presente"});case"late":return e.jsx(n,{className:"bg-yellow-500",children:"Tarde"});case"absent":return e.jsx(n,{variant:"destructive",children:"Ausente"});default:return e.jsx(n,{variant:"outline",children:"Sin marcar"})}},h=s=>new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}),N=P.filter(s=>s.is_past||s.is_today),v=P.filter(s=>!s.is_past&&!s.is_today);return e.jsxs(K,{variant:"sidebar",title:`${l.program.name} - Portal Profesor`,children:[e.jsx(J,{title:`${l.program.name} - Portal Profesor`}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:l.program.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-muted-foreground",children:[e.jsx(n,{style:{backgroundColor:l.program.color},className:"text-white",children:l.days_of_week}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(c,{iconNode:M,className:"w-4 h-4 mr-1"}),l.start_time," - ",l.end_time]}),l.location&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(c,{iconNode:te,className:"w-4 h-4 mr-1"}),l.location]})]})]}),e.jsx(B,{href:"/profesor/mis-grupos",children:e.jsx(o,{variant:"outline",children:"Volver"})})]})}),e.jsxs(Q,{defaultValue:"attendance",className:"space-y-6",children:[e.jsxs(W,{className:"grid w-full grid-cols-3",children:[e.jsxs(S,{value:"attendance",children:[e.jsx(c,{iconNode:re,className:"w-4 h-4 mr-2"}),"Asistencia"]}),e.jsxs(S,{value:"students",children:[e.jsx(c,{iconNode:de,className:"w-4 h-4 mr-2"}),"Estudiantes (",m.length,")"]}),e.jsxs(S,{value:"activities",children:[e.jsx(c,{iconNode:le,className:"w-4 h-4 mr-2"}),"Actividades (",u.length,")"]})]}),e.jsx(A,{value:"attendance",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(y,{className:"lg:col-span-1",children:[e.jsxs(w,{children:[e.jsx(k,{className:"text-lg",children:"Fechas de Clase"}),e.jsx(F,{children:"Selecciona una fecha para marcar asistencia"})]}),e.jsx(C,{className:"max-h-[500px] overflow-y-auto",children:N.length===0&&v.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay fechas de clase configuradas"}):e.jsxs("div",{className:"space-y-2",children:[N.map(s=>e.jsx("div",{onClick:()=>D(s.date),className:`p-3 rounded-lg border cursor-pointer transition-colors ${i===s.date?"border-[#7a9b3c] bg-[#7a9b3c]/10":"hover:bg-muted"} ${s.is_today?"border-blue-500 border-2":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.day_name,s.is_today&&e.jsx(n,{className:"bg-blue-500 text-xs",children:"Hoy"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:h(s.date)})]}),e.jsxs("div",{className:"text-right",children:[s.marked_count>0?e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsxs("span",{className:"text-green-600",children:[s.present_count,"P"]}),e.jsxs("span",{className:"text-yellow-600",children:[s.late_count,"T"]}),e.jsxs("span",{className:"text-red-600",children:[s.absent_count,"A"]})]}):e.jsx(n,{variant:"outline",className:"text-xs",children:"Sin marcar"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.marked_count,"/",s.total_students]})]})]})},s.date)),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-muted-foreground uppercase mt-4 mb-2",children:"Próximas clases"}),v.map(s=>e.jsx("div",{className:"p-3 rounded-lg border bg-muted opacity-60",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.day_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:h(s.date)})]}),e.jsx(n,{variant:"outline",className:"text-xs",children:"Próxima"})]})},s.date))]})]})})]}),e.jsxs(y,{className:"lg:col-span-2",children:[e.jsxs(w,{children:[e.jsx(k,{className:"text-lg",children:i?`Asistencia - ${h(i)}`:"Marcar Asistencia"}),e.jsx(F,{children:i?"Marca la asistencia de cada estudiante":"Selecciona una fecha de la lista para marcar asistencia"})]}),e.jsx(C,{children:i?m.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No hay estudiantes inscritos"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 mb-6 max-h-[400px] overflow-y-auto",children:m.map(s=>{const t=p[s.id]||s.attendance_by_date[i]?.status,a=T[s.id]??s.attendance_by_date[i]?.notes??"",r=t==="late"||t==="absent";return e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>f(s),className:"p-1",children:e.jsx(ie,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:s.name}),e.jsx("div",{className:"flex items-center gap-2",children:s.document_number&&e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[s.document_type,": ",s.document_number]})})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{size:"sm",variant:t==="present"?"default":"outline",onClick:()=>b(s.id,"present"),className:`px-2 ${t==="present"?"bg-green-600 hover:bg-green-700":""}`,title:"Presente",children:e.jsx(c,{iconNode:E,className:"w-4 h-4"})}),e.jsx(o,{size:"sm",variant:t==="late"?"default":"outline",onClick:()=>b(s.id,"late"),className:`px-2 ${t==="late"?"bg-yellow-600 hover:bg-yellow-700":""}`,title:"Tarde",children:e.jsx(c,{iconNode:L,className:"w-4 h-4"})}),e.jsx(o,{size:"sm",variant:t==="absent"?"default":"outline",onClick:()=>b(s.id,"absent"),className:`px-2 ${t==="absent"?"bg-red-600 hover:bg-red-700":""}`,title:"Ausente",children:e.jsx(c,{iconNode:z,className:"w-4 h-4"})})]})]}),r&&e.jsx("div",{className:"mt-2 ml-10",children:e.jsx("input",{type:"text",placeholder:t==="late"?"Justificación de tardanza (ej: tráfico, cita médica...)":"Razón de la ausencia...",value:a,onChange:j=>I(s.id,j.target.value),className:"w-full px-3 py-2 text-sm border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-[#7a9b3c] focus:border-transparent"})})]},s.id)})}),e.jsx(o,{onClick:V,className:"w-full bg-[#7a9b3c] hover:bg-[#6a8a2c]",disabled:Object.keys(p).length===0,children:"Guardar Asistencia"})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Selecciona una fecha de clase para marcar asistencia"})]})})]})]})}),e.jsx(A,{value:"students",children:e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Lista de Estudiantes"})}),e.jsx(C,{children:m.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No hay estudiantes inscritos en este grupo"}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted cursor-pointer",onClick:()=>f(s),children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground",children:s.name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[s.document_number&&e.jsxs("span",{className:"font-medium text-muted-foreground",children:[s.document_type,": ",s.document_number]}),e.jsx("span",{children:s.email})]})]})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[s.progress_stats.progress_percentage,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[s.progress_stats.average_grade,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Promedio"})]}),e.jsx(ce,{className:"w-5 h-5 text-muted-foreground"})]})]},s.id))})})]})}),e.jsx(A,{value:"activities",children:u.length===0?e.jsxs("div",{className:"rounded-xl border-2 border-dashed border-input bg-card p-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(H,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"mb-2 text-xl font-semibold text-foreground",children:"No hay actividades configuradas"}),e.jsx("p",{className:"text-muted-foreground",children:"Este programa aún no tiene actividades para evaluar."})]}):e.jsx("div",{className:"space-y-6",children:R.map((s,t)=>e.jsxs("div",{className:`rounded-xl border bg-card shadow-sm ${s.isLocked?"border-input opacity-75":"border-border"}`,children:[e.jsxs("div",{className:"p-6 pb-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-lg ${s.isLocked?"bg-muted":"bg-blue-100 dark:bg-blue-900/30"}`,children:s.isLocked?e.jsx(G,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(H,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Módulo ",t+1,": ",s.moduleName]}),s.description&&e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-sm text-muted-foreground",children:[s.hours>0&&e.jsxs("span",{children:[s.hours," horas"]}),s.hours>0&&e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Nivel ",s.level]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.activities.length," ",s.activities.length===1?"actividad":"actividades"]})]})]})]}),e.jsx("div",{children:s.isFullyEvaluated?e.jsxs(n,{className:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Completado"]}):s.isLocked?e.jsxs(n,{variant:"outline",className:"text-muted-foreground border-input",children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),"Bloqueado"]}):e.jsx(n,{className:"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",children:"Pendiente"})})]}),s.isLocked&&e.jsxs("div",{className:"mt-4 flex items-start gap-3 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 p-3",children:[e.jsx(L,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Debes completar la evaluación de todos los estudiantes en los módulos anteriores antes de poder evaluar este módulo."})]})]}),!s.isLocked&&e.jsx("div",{className:"px-6 pb-6",children:e.jsx("div",{className:"ml-14 space-y-3",children:s.activities.map(a=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-md bg-purple-100 dark:bg-purple-900/30",children:e.jsx(oe,{className:"h-4 w-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-foreground",children:a.name}),a.description&&e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:a.description}),e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Peso: ",a.weight,"%"]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`rounded-full px-2 py-0.5 ${a.is_fully_evaluated?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":a.evaluated_count>0?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300":"bg-muted text-muted-foreground"}`,children:a.is_fully_evaluated?"Evaluado":a.evaluated_count>0?`${a.evaluated_count}/${a.total_students} evaluados`:"Sin evaluar"})]})]})]})}),a.evaluation_criteria.length>0&&e.jsxs("div",{className:"ml-11 space-y-2 mb-3",children:[e.jsx("h6",{className:"text-xs font-semibold text-muted-foreground",children:"Criterios de Evaluación:"}),a.evaluation_criteria.map(r=>e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-border bg-card p-2",children:[e.jsx(me,{className:"h-4 w-4 text-amber-600 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-foreground flex-1",children:r.name}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[r.max_points," pts"]})]},r.id))]}),e.jsx("div",{className:"ml-11",children:e.jsx(B,{href:`/profesor/grupo/${l.id}/actividad/${a.id}/evaluar`,children:e.jsx(o,{className:"w-full bg-[#7a9b3c] hover:bg-[#6a8a2c]",children:a.is_fully_evaluated?"Ver / Editar Evaluación":"Evaluar Estudiantes"})})})]},a.id))})})]},s.moduleName))})})]})]}),e.jsx(Y,{open:!!d,onOpenChange:()=>f(null),children:e.jsxs(Z,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ee,{children:[e.jsx(se,{children:d?.name}),e.jsxs(ae,{children:[d?.document_number&&e.jsxs("span",{className:"font-medium text-muted-foreground mr-3",children:[d.document_type,": ",d.document_number]}),d?.email]})]}),d&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Resumen de Asistencia"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-950/30 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.attendance_stats.present}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:"Presente"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 dark:bg-yellow-950/30 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:d.attendance_stats.late}),e.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"Tarde"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-950/30 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.attendance_stats.absent}),e.jsx("div",{className:"text-xs text-red-700 dark:text-red-300",children:"Ausente"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Historial de Asistencias"}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:N.map(s=>{const t=d.attendance_by_date[s.date];return e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[U(t?.status||""),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.day_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:h(s.date)})]})]}),q(t?.status||"")]}),t?.notes&&e.jsxs("div",{className:"mt-2 ml-7 text-sm text-muted-foreground bg-muted rounded p-2",children:[e.jsx("span",{className:"font-medium",children:"Nota: "}),t.notes]})]},s.date)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Avance Académico"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600",children:"Progreso"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-700 dark:text-blue-300",children:[d.progress_stats.progress_percentage,"%"]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[d.progress_stats.evaluated_activities," de ",d.progress_stats.total_activities," actividades"]})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/30 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600",children:"Promedio"}),e.jsxs("div",{className:"text-3xl font-bold text-green-700 dark:text-green-300",children:[d.progress_stats.average_grade,"%"]}),e.jsx("div",{className:"text-xs text-green-600",children:"Calificación general"})]})]})]})]})]})})]})}export{es as default};
