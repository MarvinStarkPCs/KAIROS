import{r as A,j as e,H as R,L as E,a as I}from"./app-05ShooGQ.js";import{A as V}from"./app-layout-CR3KzzE7.js";import{B as f}from"./button-BD8539R6.js";import{C as g,b as P,c as S,a as v}from"./card-aPzxDnlK.js";import{B as m}from"./badge-CbecJKql.js";import{I as T}from"./input-DWBzlYOO.js";import{T as z}from"./textarea-Dtf_NSR0.js";import{L as N}from"./label-BuRjJQVS.js";import{I as y}from"./app-header-DhUaObwM.js";import{A as O}from"./arrow-left-BELGf3DJ.js";import{G as q}from"./graduation-cap-0xoJFm5c.js";import{T as _}from"./triangle-alert-33If-vp1.js";import{C as J}from"./circle-check-big-BccvDQTA.js";import{S as K}from"./save-UmBDl0oV.js";/* empty css            */import"./utils-QIaTb7Ic.js";import"./index-D5cJpMRO.js";import"./index-DpNXXy9o.js";import"./createLucideIcon-jgmphIs6.js";import"./index-BxkeiSwP.js";import"./index-YFaldniu.js";import"./index-DJ9QZhGu.js";import"./toaster-c0Tzfo0H.js";import"./index-NETZMin-.js";import"./chevron-right-OTkE61dJ.js";import"./index-DE-kI2jP.js";import"./index-CLa6oRL-.js";import"./wayfinder-Bf9OnZdi.js";import"./index-D12nj1Ca.js";import"./book-open-OnlFKIlA.js";import"./users-BTmOshtK.js";import"./credit-card-BuSrC1Ii.js";import"./calendar-CmeM68J-.js";import"./file-text-DvijEh9m.js";import"./lock-B3HqQlmb.js";import"./shield-DSwyy0H4.js";import"./chevron-down-DwoHTTy4.js";import"./loader-circle-CaH6ryvJ.js";import"./mail-ku6KC86U.js";function Me({schedule:x,activity:i,students:o}){const[w,B]=A.useState(new Date().toISOString().split("T")[0]),[h,$]=A.useState(()=>{const a={};return o.forEach(s=>{a[s.id]={student_id:s.id,criteria:i.evaluation_criteria.map(r=>{const d=s.existing_evaluations.find(t=>t.evaluation_criteria_id===r.id);return{evaluation_criteria_id:r.id,points_earned:Number(d?.points_earned??0)}}),feedback:s.existing_evaluations[0]?.feedback||""}}),a}),M=(a,s,r)=>{const d=parseFloat(r)||0,t=i.evaluation_criteria.find(l=>l.id===s)?.max_points??0,u=Math.min(Math.max(d,0),t);$(l=>({...l,[a]:{...l[a],criteria:l[a].criteria.map(n=>n.evaluation_criteria_id===s?{...n,points_earned:u}:n)}}))},L=(a,s)=>{$(r=>({...r,[a]:{...r[a],feedback:s}}))},k=a=>{const s=h[a]?.criteria;return!s||s.length===0?0:s.reduce((r,d)=>r+Number(d.points_earned||0),0)},p=()=>!i.evaluation_criteria||i.evaluation_criteria.length===0?0:i.evaluation_criteria.reduce((a,s)=>a+Number(s.max_points||0),0),F=a=>{const s=p(),r=k(a);return s>0?Math.round(r/s*100):0},b=a=>a>=80?"text-green-600":a>=60?"text-blue-600":a>=40?"text-amber-600":"text-red-600",W=a=>a>=80?"stroke-green-500":a>=60?"stroke-blue-500":a>=40?"stroke-amber-500":"stroke-red-500",D=a=>a>=80?"bg-green-50 border-green-200":a>=60?"bg-blue-50 border-blue-200":a>=40?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200",G=a=>a>=90?"Excelente":a>=80?"Muy bien":a>=70?"Bien":a>=60?"Aceptable":a>=40?"Insuficiente":"Bajo",H=()=>{const a=o.filter(r=>r.has_attendance);if(a.length===0){alert("No hay estudiantes con asistencia registrada para evaluar. Primero debe marcar asistencia.");return}const s=a.map(r=>h[r.id]);I.post(`/profesor/grupo/${x.id}/actividad/${i.id}/evaluaciones`,{evaluation_date:w,evaluations:s})},c=o.filter(a=>a.has_attendance).length,C=o.filter(a=>!a.has_attendance).length;return e.jsxs(V,{variant:"sidebar",title:`Evaluar: ${i.name} - Portal Profesor`,children:[e.jsx(R,{title:`Evaluar: ${i.name} - Portal Profesor`}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Evaluar Actividad"}),e.jsx("p",{className:"text-gray-600",children:x.program.name})]}),e.jsx(E,{href:`/profesor/grupo/${x.id}`,children:e.jsxs(f,{variant:"outline",children:[e.jsx(y,{iconNode:O,className:"w-4 h-4 mr-2"}),"Volver"]})})]})}),e.jsxs(g,{className:"mb-6",children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-2xl mb-2",children:i.name}),e.jsx("p",{className:"text-gray-600 mb-3",children:i.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",children:i.study_plan.module_name}),e.jsxs(m,{variant:"secondary",children:["Peso: ",i.weight,"%"]}),e.jsxs(m,{variant:"secondary",children:["Puntaje Total: ",p()," puntos"]})]})]}),e.jsx(y,{iconNode:q,className:"w-12 h-12 text-[#7a9b3c]"})]})}),e.jsx(v,{children:e.jsxs("div",{children:[e.jsx(N,{htmlFor:"evaluation_date",children:"Fecha de Evaluación"}),e.jsx(T,{id:"evaluation_date",type:"date",value:w,onChange:a=>B(a.target.value),className:"max-w-xs"})]})})]}),C>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-800",children:"Estudiantes sin asistencia registrada"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:[C," estudiante(s) no tienen asistencia registrada y no pueden ser evaluados.",c>0&&` Solo se evaluarán ${c} estudiante(s) con asistencia.`]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:'Vaya a la pestaña "Marcar Asistencia" para registrar la asistencia antes de evaluar.'})]})]})}),e.jsx("div",{className:"space-y-6",children:o.length===0?e.jsx(g,{children:e.jsx(v,{className:"py-12 text-center text-gray-500",children:"No hay estudiantes para evaluar"})}):o.map(a=>{const s=F(a.id),r=k(a.id),d=p();return e.jsxs("div",{children:[a.has_attendance&&e.jsxs("div",{className:`sticky top-0 z-20 flex items-center justify-between rounded-t-lg border border-b-0 px-4 py-2 shadow-md ${D(s)}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative h-11 w-11 flex-shrink-0",children:[e.jsxs("svg",{className:"h-11 w-11 -rotate-90",viewBox:"0 0 48 48",children:[e.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"none",className:"stroke-gray-200",strokeWidth:"4"}),e.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"none",className:`transition-all duration-500 ${W(s)}`,strokeWidth:"4",strokeLinecap:"round",strokeDasharray:`${s/100*125.7} 125.7`})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:`text-xs font-bold ${b(s)}`,children:[s,"%"]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:`text-base font-bold ${b(s)}`,children:[r," / ",d," pts"]}),e.jsx("div",{className:`text-xs font-medium ${b(s)}`,children:G(s)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 hidden sm:inline",children:a.name}),e.jsx("div",{className:"hidden sm:block w-32",children:e.jsx("div",{className:"h-3 w-full overflow-hidden rounded-full bg-white/60",children:e.jsx("div",{className:`h-full transition-all duration-500 rounded-full ${s>=80?"bg-green-500":s>=60?"bg-blue-500":s>=40?"bg-amber-500":"bg-red-500"}`,style:{width:`${Math.min(s,100)}%`}})})})]})]}),e.jsxs(g,{className:`${a.has_attendance?"rounded-t-none":"border-yellow-300 bg-yellow-50/50"}`,children:[e.jsx(P,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{children:a.name}),a.has_attendance?e.jsxs(m,{className:"bg-green-500",children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"Asistencia registrada"]}):e.jsxs(m,{variant:"destructive",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Sin asistencia"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[a.document_number&&e.jsxs("span",{className:"font-medium text-gray-700",children:[a.document_type,": ",a.document_number]}),e.jsx("span",{children:a.email})]}),a.has_attendance&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Asistencia: ",a.attendance_stats.present,"P / ",a.attendance_stats.late,"T / ",a.attendance_stats.absent,"A (",a.attendance_stats.total," clases)"]})]})})}),e.jsx(v,{children:a.has_attendance?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Criterios de Evaluación"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.evaluation_criteria.map(t=>{const u=Number(h[a.id]?.criteria.find(j=>j.evaluation_criteria_id===t.id)?.points_earned??0),l=Number(t.max_points||0),n=l>0?Math.round(u/l*100):0;return e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{htmlFor:`student-${a.id}-criteria-${t.id}`,className:"text-sm font-medium",children:t.name}),e.jsxs("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${n>=80?"bg-green-100 text-green-700":n>=60?"bg-blue-100 text-blue-700":n>=40?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:[n,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{id:`student-${a.id}-criteria-${t.id}`,type:"number",min:"0",max:t.max_points,step:"0.5",value:u,onChange:j=>M(a.id,t.id,j.target.value),className:"w-24 text-center"}),e.jsx("span",{className:"text-sm text-gray-400",children:"/"}),e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[t.max_points," pts"]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-gray-200",children:e.jsx("div",{className:`h-full transition-all duration-300 rounded-full ${n>=80?"bg-green-500":n>=60?"bg-blue-500":n>=40?"bg-amber-500":"bg-red-500"}`,style:{width:`${Math.min(n,100)}%`}})})})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500",children:t.description})]},t.id)})})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:`feedback-${a.id}`,children:"Retroalimentación (opcional)"}),e.jsx(z,{id:`feedback-${a.id}`,placeholder:"Escribe comentarios o sugerencias para el estudiante...",value:h[a.id]?.feedback||"",onChange:t=>L(a.id,t.target.value),rows:3})]})]}):e.jsxs("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 text-center",children:[e.jsx(_,{className:"w-8 h-8 text-yellow-600 mx-auto mb-2"}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"No se puede evaluar a este estudiante"}),e.jsx("p",{className:"text-yellow-700 text-sm mt-1",children:"Primero debe registrar al menos una asistencia para este estudiante."})]})})]})]},a.id)})}),o.length>0&&e.jsxs("div",{className:"mt-8 flex gap-4",children:[e.jsxs(f,{onClick:H,className:"flex-1 bg-[#7a9b3c] hover:bg-[#6a8a2c] text-lg py-6 disabled:bg-gray-400",disabled:c===0,children:[e.jsx(y,{iconNode:K,className:"w-5 h-5 mr-2"}),c===0?"No hay estudiantes para evaluar":`Guardar Evaluaciones (${c} estudiante${c!==1?"s":""})`]}),e.jsx(E,{href:`/profesor/grupo/${x.id}`,className:"flex-shrink-0",children:e.jsx(f,{variant:"outline",className:"text-lg py-6",children:"Cancelar"})})]})]})]})}export{Me as default};
