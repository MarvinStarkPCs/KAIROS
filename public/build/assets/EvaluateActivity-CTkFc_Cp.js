import{r as w,j as e,H as F,L as C,a as L}from"./app-DQdfAIrT.js";import{A as B}from"./app-layout-4clgNQ85.js";import{B as h}from"./button-VerjejBs.js";import{C as j,b as $,c as A,a as u}from"./card-xa_nu3wW.js";import{B as o}from"./badge-D23JO_t_.js";import{I as E}from"./input-j1xB4kZV.js";import{T as M}from"./textarea-VWt55U19.js";import{L as g}from"./label-C3O-cvO1.js";import{I as v}from"./app-header-BJ6Qh71R.js";import{A as D}from"./arrow-left-BmihY2cx.js";import{G}from"./graduation-cap-BqNDqZIZ.js";import{T as f}from"./triangle-alert-0XJMW1br.js";import{C as H}from"./circle-check-big-ZsaYAgn9.js";import{S as W}from"./save-Oh9uFbTf.js";import"./app-C-cf51TB.js";import"./utils-CBfrqCZ4.js";import"./index-CfWGIfzM.js";import"./index-C7yH7irC.js";import"./index-DgJsnbTO.js";import"./createLucideIcon-FBGZZ2XP.js";import"./index-C47Lcm81.js";import"./index-IgmI3j8n.js";import"./index-BzC76F-K.js";import"./toaster-B_zTenYs.js";import"./index-CdJFUDDL.js";import"./chevron-right-Bj574-qT.js";import"./index-Q9OWOLmH.js";import"./index-BGHOW37F.js";import"./wayfinder-Bf9OnZdi.js";import"./index-DvImgo4L.js";import"./users-D1XkPNsH.js";import"./credit-card-BIFgk_mu.js";import"./calendar-YX0MwFSw.js";import"./file-text-CdhlA8Sa.js";import"./lock-Bhi6MTHY.js";import"./shield-DJVllbGN.js";import"./mail-C6vpu2CA.js";function we({schedule:c,activity:i,students:r}){const[N,k]=w.useState(new Date().toISOString().split("T")[0]),[d,b]=w.useState(()=>{const a={};return r.forEach(s=>{a[s.id]={student_id:s.id,criteria:i.evaluation_criteria.map(t=>{const x=s.existing_evaluations.find(n=>n.evaluation_criteria_id===t.id);return{evaluation_criteria_id:t.id,points_earned:x?.points_earned||0}}),feedback:s.existing_evaluations[0]?.feedback||""}}),a}),T=(a,s,t)=>{const x=parseFloat(t)||0;b(n=>({...n,[a]:{...n[a],criteria:n[a].criteria.map(p=>p.evaluation_criteria_id===s?{...p,points_earned:x}:p)}}))},P=(a,s)=>{b(t=>({...t,[a]:{...t[a],feedback:s}}))},_=a=>d[a]?.criteria.reduce((s,t)=>s+t.points_earned,0)||0,m=()=>i.evaluation_criteria.reduce((a,s)=>a+s.max_points,0),S=()=>{const a=r.filter(t=>t.has_attendance);if(a.length===0){alert("No hay estudiantes con asistencia registrada para evaluar. Primero debe marcar asistencia.");return}const s=a.map(t=>d[t.id]);L.post(`/profesor/grupo/${c.id}/actividad/${i.id}/evaluaciones`,{evaluation_date:N,evaluations:s})},l=r.filter(a=>a.has_attendance).length,y=r.filter(a=>!a.has_attendance).length;return e.jsxs(B,{variant:"sidebar",title:`Evaluar: ${i.name} - Portal Profesor`,children:[e.jsx(F,{title:`Evaluar: ${i.name} - Portal Profesor`}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Evaluar Actividad"}),e.jsx("p",{className:"text-gray-600",children:c.program.name})]}),e.jsx(C,{href:`/profesor/grupo/${c.id}`,children:e.jsxs(h,{variant:"outline",children:[e.jsx(v,{iconNode:D,className:"w-4 h-4 mr-2"}),"Volver"]})})]})}),e.jsxs(j,{className:"mb-6",children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{className:"text-2xl mb-2",children:i.name}),e.jsx("p",{className:"text-gray-600 mb-3",children:i.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",children:i.study_plan.module_name}),e.jsxs(o,{variant:"secondary",children:["Peso: ",i.weight,"%"]}),e.jsxs(o,{variant:"secondary",children:["Puntaje Total: ",m()," puntos"]})]})]}),e.jsx(v,{iconNode:G,className:"w-12 h-12 text-[#7a9b3c]"})]})}),e.jsx(u,{children:e.jsxs("div",{children:[e.jsx(g,{htmlFor:"evaluation_date",children:"Fecha de Evaluación"}),e.jsx(E,{id:"evaluation_date",type:"date",value:N,onChange:a=>k(a.target.value),className:"max-w-xs"})]})})]}),y>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(f,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-800",children:"Estudiantes sin asistencia registrada"}),e.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:[y," estudiante(s) no tienen asistencia registrada y no pueden ser evaluados.",l>0&&` Solo se evaluarán ${l} estudiante(s) con asistencia.`]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:'Vaya a la pestaña "Marcar Asistencia" para registrar la asistencia antes de evaluar.'})]})]})}),e.jsx("div",{className:"space-y-6",children:r.length===0?e.jsx(j,{children:e.jsx(u,{className:"py-12 text-center text-gray-500",children:"No hay estudiantes para evaluar"})}):r.map(a=>e.jsxs(j,{className:a.has_attendance?"":"border-yellow-300 bg-yellow-50/50",children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{children:a.name}),a.has_attendance?e.jsxs(o,{className:"bg-green-500",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"Asistencia registrada"]}):e.jsxs(o,{variant:"destructive",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"Sin asistencia"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:a.email}),a.has_attendance&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Asistencia: ",a.attendance_stats.present,"P / ",a.attendance_stats.late,"T / ",a.attendance_stats.absent,"A (",a.attendance_stats.total," clases)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-3xl font-bold ${a.has_attendance?"text-gray-900":"text-gray-400"}`,children:[_(a.id),"/",m()]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[m()>0?Math.round(_(a.id)/m()*100):0,"%"]})]})]})}),e.jsx(u,{children:a.has_attendance?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Criterios de Evaluación"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.evaluation_criteria.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:`student-${a.id}-criteria-${s.id}`,children:[s.name,e.jsxs("span",{className:"text-gray-500 ml-2 text-sm",children:["(Max: ",s.max_points," pts)"]})]}),e.jsx(E,{id:`student-${a.id}-criteria-${s.id}`,type:"number",min:"0",max:s.max_points,step:"0.5",value:d[a.id]?.criteria.find(t=>t.evaluation_criteria_id===s.id)?.points_earned||0,onChange:t=>T(a.id,s.id,t.target.value)}),s.description&&e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]},s.id))})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:`feedback-${a.id}`,children:"Retroalimentación (opcional)"}),e.jsx(M,{id:`feedback-${a.id}`,placeholder:"Escribe comentarios o sugerencias para el estudiante...",value:d[a.id]?.feedback||"",onChange:s=>P(a.id,s.target.value),rows:3})]})]}):e.jsxs("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 text-center",children:[e.jsx(f,{className:"w-8 h-8 text-yellow-600 mx-auto mb-2"}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"No se puede evaluar a este estudiante"}),e.jsx("p",{className:"text-yellow-700 text-sm mt-1",children:"Primero debe registrar al menos una asistencia para este estudiante."})]})})]},a.id))}),r.length>0&&e.jsxs("div",{className:"mt-8 flex gap-4",children:[e.jsxs(h,{onClick:S,className:"flex-1 bg-[#7a9b3c] hover:bg-[#6a8a2c] text-lg py-6 disabled:bg-gray-400",disabled:l===0,children:[e.jsx(v,{iconNode:W,className:"w-5 h-5 mr-2"}),l===0?"No hay estudiantes para evaluar":`Guardar Evaluaciones (${l} estudiante${l!==1?"s":""})`]}),e.jsx(C,{href:`/profesor/grupo/${c.id}`,className:"flex-shrink-0",children:e.jsx(h,{variant:"outline",className:"text-lg py-6",children:"Cancelar"})})]})]})]})}export{we as default};
