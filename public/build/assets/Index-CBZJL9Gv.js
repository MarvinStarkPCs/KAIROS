import{r as o,u as _,a as d,j as e,H as w}from"./app-CskC5zpI.js";import{A as D}from"./app-layout-DBpMxMjR.js";import{B as m}from"./button-Ln_z6fUu.js";import{C as I,b as T,c as L,d as E,a as M}from"./card-CjYBGHhU.js";import{D as H,a as A,b as B,c as O,d as k,e as P}from"./dialog-DWgK-bHq.js";import{S as Q,a as V,b as $,c as q,d as F}from"./select-CTAfelHo.js";import{I as R}from"./input-DNV9vFNh.js";import{s as u}from"./index-ikzcNs2d.js";import{P as U}from"./plus-DUGMkoUM.js";import{S as z,M as G}from"./app-header-CjVVaiqG.js";import"./app-3tATqUqq.js";import"./utils-CBfrqCZ4.js";import"./index-DKO42eCq.js";import"./index-CNDk2MoS.js";import"./index-B3U3a8oW.js";import"./createLucideIcon-BgVWJ3l5.js";import"./index-BP0c6JSM.js";import"./index-Cbqf3fGf.js";import"./index-FXNg9LRQ.js";import"./toaster-DqNn9mIT.js";import"./index-CdJFUDDL.js";import"./check-WNifdbqF.js";import"./graduation-cap-CNZvr81n.js";import"./index-BtdFLURo.js";import"./index-BTBqsq4d.js";import"./wayfinder-FFrBTblC.js";import"./index-ChSmD2lF.js";import"./users-BnAHZaPn.js";import"./credit-card-BYVQbHwm.js";import"./calendar-CJejbeEX.js";import"./file-text-OAVThfgg.js";import"./lock-DgRYFDVp.js";import"./shield-oxWIHUMV.js";import"./music-0YscbjcE.js";import"./mail-Btvbj2T2.js";function Le({conversations:t,availableUsers:x}){const[p,l]=o.useState(!1),[a,h]=o.useState(""),{data:f,setData:g,post:j,processing:N,errors:c,reset:v}=_({user_id:""}),y=s=>{s.preventDefault(),j(u("comunicacion.start"),{onSuccess:()=>{v(),l(!1)}})},S=s=>{if(!s)return"";const r=new Date(s),C=new Date().getTime()-r.getTime(),n=Math.floor(C/(1e3*60*60*24));return n===0?r.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):n===1?"Ayer":n<7?r.toLocaleDateString("es-ES",{weekday:"short"}):r.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"})},b=(s,r=50)=>s.length<=r?s:s.substring(0,r)+"...",i=t.filter(s=>s.other_user?.name.toLowerCase().includes(a.toLowerCase())||s.other_user?.email.toLowerCase().includes(a.toLowerCase()));return o.useEffect(()=>{const s=setInterval(()=>{d.reload({only:["conversations"],preserveScroll:!0,preserveState:!0})},5e3);return()=>clearInterval(s)},[]),e.jsxs(D,{children:[e.jsx(w,{title:"Comunicaciones"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Comunicaciones"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Conversa con otros usuarios del sistema"})]}),e.jsxs(H,{open:p,onOpenChange:l,children:[e.jsx(A,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Nueva conversación"]})}),e.jsxs(B,{children:[e.jsxs(O,{children:[e.jsx(k,{children:"Iniciar nueva conversación"}),e.jsx(P,{children:"Selecciona un usuario para iniciar una conversación"})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Q,{value:f.user_id,onValueChange:s=>g("user_id",s),children:[e.jsx(V,{children:e.jsx($,{placeholder:"Seleccionar usuario"})}),e.jsx(q,{children:x.map(s=>e.jsxs(F,{value:s.id.toString(),children:[s.name," (",s.email,")"]},s.id))})]}),c.user_id&&e.jsx("p",{className:"text-sm text-destructive",children:c.user_id})]}),e.jsx(m,{type:"submit",disabled:N,className:"w-full",children:"Iniciar conversación"})]})]})]})]}),e.jsxs(I,{children:[e.jsxs(T,{children:[e.jsx(L,{children:"Tus conversaciones"}),e.jsx(E,{children:t.length===0?"No tienes conversaciones activas":`${t.length} conversación${t.length!==1?"es":""}`})]}),e.jsxs(M,{children:[t.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(R,{type:"text",placeholder:"Buscar conversaciones...",value:a,onChange:s=>h(s.target.value),className:"pl-10"})]})}),i.length===0&&t.length>0&&e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No se encontraron conversaciones"}),i.length===0&&t.length===0&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(G,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"No tienes conversaciones aún"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inicia una nueva conversación con el botón de arriba"})]}),e.jsx("div",{className:"space-y-2",children:i.map(s=>e.jsx("button",{onClick:()=>d.visit(u("comunicacion.show",{conversation:s.id})),className:"w-full rounded-lg border p-4 text-left transition-colors hover:bg-accent",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:s.other_user?.name||"Usuario desconocido"}),s.last_message_at&&e.jsx("span",{className:"text-xs text-muted-foreground",children:S(s.last_message_at)})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.other_user?.email}),s.latest_message&&e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:[s.latest_message.is_mine&&"Tú: ",b(s.latest_message.body)]})]}),s.unread_count>0&&e.jsx("div",{className:"ml-4 flex h-6 w-6 items-center justify-center rounded-full bg-primary text-xs font-medium text-primary-foreground",children:s.unread_count})]})},s.id))})]})]})]})]})}export{Le as default};
