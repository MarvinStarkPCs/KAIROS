import{j as e,r as n,F as h,H as S}from"./app-C_wc9es_.js";import{H as A}from"./heading-small-B4QFQAz_.js";import{B as p}from"./button-CK7_c_5e.js";import{C as T,b as k,c as F,d as _,a as M}from"./card-qYJq1A3u.js";import{c as D,d as z,b as I,e as R,f as H}from"./index-DmHkLzld.js";import{A as V,b as O,a as E}from"./alert-Cp6Qf5YN.js";import{C as L}from"./circle-alert-C6cd94CF.js";import{c as j}from"./createLucideIcon-Cl_h1Hpc.js";import{E as B}from"./eye-off-BQ86ZvcZ.js";import{E as P}from"./eye-DFqR6Zng.js";import{R as $}from"./refresh-cw-BgE7mHnV.js";import{I as G}from"./input-error-DFCknaJe.js";import{D as q,a as K,b as Q,c as X,d as J}from"./dialog-CZ2QG5Ox.js";import{I as U,K as W,O as g,a as Y,b as Z,u as ee}from"./use-two-factor-auth-CSlh1UKE.js";import{L as y}from"./loader-circle-DIXjFJg0.js";import{C as se}from"./check-BINbHuVB.js";import{B as v}from"./badge-BXPN97dQ.js";import{A as ae}from"./app-layout-RCkHY00m.js";import{S as re}from"./layout-W5EpX7qG.js";import{S as N}from"./shield-check-nv0790gX.js";/* empty css            */import"./utils-BTwnVSy2.js";import"./index-CNhhqjg2.js";import"./wayfinder-Bf9OnZdi.js";import"./app-header-3tM_PALz.js";import"./chevron-right-FEguOG6w.js";import"./index-myZmSymV.js";import"./index-Be2p5AN3.js";import"./index-BPZo39PE.js";import"./index-DJBO6EKN.js";import"./index-BLRCw3fc.js";import"./index-BXFwRZdy.js";import"./index-CLa6oRL-.js";import"./index-D12nj1Ca.js";import"./book-open-DgLAYnVa.js";import"./graduation-cap-DpEnpuH4.js";import"./users-BlXHteJc.js";import"./credit-card-Cyqos1IL.js";import"./calendar-CdY4SBhE.js";import"./file-text-BcV-VVC0.js";import"./lock-l4QBdaDv.js";import"./shield-Dk7fcTnH.js";import"./chevron-down-D4MJa3Wh.js";import"./mail-jATxNgrm.js";import"./toaster-eRoXJvOx.js";import"./heading-FIQ0xFg-.js";import"./index-BbeadLAU.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ie=j("Copy",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["circle",{cx:"12",cy:"16",r:"1",key:"1au0dj"}],["rect",{x:"3",y:"10",width:"18",height:"12",rx:"2",key:"6s8ecr"}],["path",{d:"M7 10V7a5 5 0 0 1 10 0v3",key:"1pqi11"}]],oe=j("LockKeyhole",ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],le=j("ScanLine",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m4.243 5.21 14.39 12.472",key:"1c9a7c"}]],ue=j("ShieldBan",de);function w({errors:r,title:s}){return e.jsxs(V,{variant:"destructive",children:[e.jsx(L,{}),e.jsx(O,{children:s||"Algo salió mal."}),e.jsx(E,{children:e.jsx("ul",{className:"list-inside list-disc text-sm",children:Array.from(new Set(r)).map((t,a)=>e.jsx("li",{children:t},a))})})]})}function me({recoveryCodesList:r,fetchRecoveryCodes:s,errors:t}){const[a,i]=n.useState(!1),o=n.useRef(null),c=r.length>0&&a,d=n.useCallback(async()=>{!a&&!r.length&&await s(),i(!a),a||setTimeout(()=>{o.current?.scrollIntoView({behavior:"smooth",block:"nearest"})})},[a,r.length,s]);n.useEffect(()=>{r.length||s()},[r.length,s]);const m=a?B:P;return e.jsxs(T,{children:[e.jsxs(k,{children:[e.jsxs(F,{className:"flex gap-3",children:[e.jsx(oe,{className:"size-4","aria-hidden":"true"}),"Códigos de Recuperación 2FA"]}),e.jsx(_,{children:"Los códigos de recuperación te permiten recuperar el acceso si pierdes tu dispositivo 2FA. Guárdalos en un gestor de contraseñas seguro."})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex flex-col gap-3 select-none sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(p,{onClick:d,className:"w-fit","aria-expanded":a,"aria-controls":"recovery-codes-section",children:[e.jsx(m,{className:"size-4","aria-hidden":"true"}),a?"Ocultar":"Ver"," Códigos de Recuperación"]}),c&&e.jsx(h,{...D.form(),options:{preserveScroll:!0},onSuccess:s,children:({processing:l})=>e.jsxs(p,{variant:"secondary",type:"submit",disabled:l,"aria-describedby":"regenerate-warning",children:[e.jsx($,{})," Regenerar Códigos"]})})]}),e.jsx("div",{id:"recovery-codes-section",className:`relative overflow-hidden transition-all duration-300 ${a?"h-auto opacity-100":"h-0 opacity-0"}`,"aria-hidden":!a,children:e.jsx("div",{className:"mt-3 space-y-3",children:t?.length?e.jsx(w,{errors:t}):e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:o,className:"grid gap-1 rounded-lg bg-muted p-4 font-mono text-sm",role:"list","aria-label":"Códigos de recuperación",children:r.length?r.map((l,u)=>e.jsx("div",{role:"listitem",className:"select-text",children:l},u)):e.jsx("div",{className:"space-y-2","aria-label":"Cargando códigos de recuperación",children:Array.from({length:8},(l,u)=>e.jsx("div",{className:"h-4 animate-pulse rounded bg-muted-foreground/20","aria-hidden":"true"},u))})}),e.jsx("div",{className:"text-xs text-muted-foreground select-none",children:e.jsxs("p",{id:"regenerate-warning",children:["Cada código de recuperación puede ser usado una vez para acceder a tu cuenta y será eliminado después de su uso. Si necesitas más, haz clic en"," ",e.jsx("span",{className:"font-bold",children:"Regenerar Códigos"})," ","arriba."]})})]})})})]})]})}function pe(){const[r,s]=n.useState(null),t=n.useCallback(async a=>{if(!navigator?.clipboard)return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(a),s(a),!0}catch(i){return console.warn("Copy failed",i),s(null),!1}},[]);return[r,t]}function xe(){return e.jsx("div",{className:"mb-3 rounded-full border border-border bg-card p-0.5 shadow-sm",children:e.jsxs("div",{className:"relative overflow-hidden rounded-full border border-border bg-muted p-2.5",children:[e.jsx("div",{className:"absolute inset-0 grid grid-cols-5 opacity-50",children:Array.from({length:5},(r,s)=>e.jsx("div",{className:"border-r border-border last:border-r-0"},`col-${s+1}`))}),e.jsx("div",{className:"absolute inset-0 grid grid-rows-5 opacity-50",children:Array.from({length:5},(r,s)=>e.jsx("div",{className:"border-b border-border last:border-b-0"},`row-${s+1}`))}),e.jsx(le,{className:"relative z-20 size-6 text-foreground"})]})})}function fe({qrCodeSvg:r,manualSetupKey:s,buttonText:t,onNextStep:a,errors:i}){const[o,c]=pe(),d=o===s?se:ie;return e.jsx(e.Fragment,{children:i?.length?e.jsx(w,{errors:i}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mx-auto flex max-w-md overflow-hidden",children:e.jsx("div",{className:"mx-auto aspect-square w-64 rounded-lg border border-border",children:e.jsx("div",{className:"z-10 flex h-full w-full items-center justify-center p-5",children:r?e.jsx("div",{dangerouslySetInnerHTML:{__html:r}}):e.jsx(y,{className:"flex size-4 animate-spin"})})})}),e.jsx("div",{className:"flex w-full space-x-5",children:e.jsx(p,{className:"w-full",onClick:a,children:t})}),e.jsxs("div",{className:"relative flex w-full items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 top-1/2 h-px w-full bg-border"}),e.jsx("span",{className:"relative bg-card px-2 py-1",children:"o ingresa el código manualmente"})]}),e.jsx("div",{className:"flex w-full space-x-2",children:e.jsx("div",{className:"flex w-full items-stretch overflow-hidden rounded-xl border border-border",children:s?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",readOnly:!0,value:s,className:"h-full w-full bg-background p-3 text-foreground outline-none"}),e.jsx("button",{onClick:()=>c(s),className:"border-l border-border px-3 hover:bg-muted",children:e.jsx(d,{className:"w-4"})})]}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted p-3",children:e.jsx(y,{className:"size-4 animate-spin"})})})})]})})}function he({onClose:r,onBack:s}){const[t,a]=n.useState(""),i=n.useRef(null);return n.useEffect(()=>{setTimeout(()=>{i.current?.querySelector("input")?.focus()},0)},[]),e.jsx(h,{...z.form(),onSuccess:()=>r(),resetOnError:!0,resetOnSuccess:!0,children:({processing:o,errors:c})=>e.jsx(e.Fragment,{children:e.jsxs("div",{ref:i,className:"relative w-full space-y-3",children:[e.jsxs("div",{className:"flex w-full flex-col items-center space-y-3 py-2",children:[e.jsx(U,{id:"otp",name:"code",maxLength:g,onChange:a,disabled:o,pattern:W,children:e.jsx(Y,{children:Array.from({length:g},(d,m)=>e.jsx(Z,{index:m},m))})}),e.jsx(G,{message:c?.confirmTwoFactorAuthentication?.code})]}),e.jsxs("div",{className:"flex w-full space-x-5",children:[e.jsx(p,{type:"button",variant:"outline",className:"flex-1",onClick:s,disabled:o,children:"Atrás"}),e.jsx(p,{type:"submit",className:"flex-1",disabled:o||t.length<g,children:"Confirmar"})]})]})})})}function je({isOpen:r,onClose:s,requiresConfirmation:t,twoFactorEnabled:a,qrCodeSvg:i,manualSetupKey:o,clearSetupData:c,fetchSetupData:d,errors:m}){const[l,u]=n.useState(!1),x=n.useMemo(()=>a?{title:"Autenticación de Dos Factores Habilitada",description:"La autenticación de dos factores ahora está habilitada. Escanea el código QR o ingresa la clave de configuración en tu aplicación de autenticación.",buttonText:"Cerrar"}:l?{title:"Verificar Código de Autenticación",description:"Ingresa el código de 6 dígitos de tu aplicación de autenticación",buttonText:"Continuar"}:{title:"Habilitar Autenticación de Dos Factores",description:"Para finalizar la habilitación de la autenticación de dos factores, escanea el código QR o ingresa la clave de configuración en tu aplicación de autenticación",buttonText:"Continuar"},[a,l]),f=n.useCallback(()=>{if(t){u(!0);return}c(),s()},[t,c,s]),b=n.useCallback(()=>{u(!1),a&&c()},[a,c]);return n.useEffect(()=>{if(!r){b();return}i||d()},[r,i,d,b]),e.jsx(q,{open:r,onOpenChange:C=>!C&&s(),children:e.jsxs(K,{className:"sm:max-w-md",children:[e.jsxs(Q,{className:"flex items-center justify-center",children:[e.jsx(xe,{}),e.jsx(X,{children:x.title}),e.jsx(J,{className:"text-center",children:x.description})]}),e.jsx("div",{className:"flex flex-col items-center space-y-5",children:l?e.jsx(he,{onClose:s,onBack:()=>u(!1)}):e.jsx(fe,{qrCodeSvg:i,manualSetupKey:o,buttonText:x.buttonText,onNextStep:f,errors:m})})]})})}const ge=[{title:"Autenticación de Dos Factores",href:I.url()}];function ms({requiresConfirmation:r=!1,twoFactorEnabled:s=!1}){const{qrCodeSvg:t,hasSetupData:a,manualSetupKey:i,clearSetupData:o,fetchSetupData:c,recoveryCodesList:d,fetchRecoveryCodes:m,errors:l}=ee(),[u,x]=n.useState(!1);return e.jsxs(ae,{breadcrumbs:ge,children:[e.jsx(S,{title:"Autenticación de Dos Factores"}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{title:"Autenticación de Dos Factores",description:"Administra la configuración de autenticación de dos factores"}),s?e.jsxs("div",{className:"flex flex-col items-start justify-start space-y-4",children:[e.jsx(v,{variant:"default",children:"Habilitada"}),e.jsx("p",{className:"text-muted-foreground",children:"Con la autenticación de dos factores habilitada, se te solicitará un código seguro y aleatorio durante el inicio de sesión, el cual puedes obtener desde la aplicación compatible con TOTP en tu teléfono."}),e.jsx(me,{recoveryCodesList:d,fetchRecoveryCodes:m,errors:l}),e.jsx("div",{className:"relative inline",children:e.jsx(h,{...R.form(),children:({processing:f})=>e.jsxs(p,{variant:"destructive",type:"submit",disabled:f,children:[e.jsx(ue,{})," Deshabilitar 2FA"]})})})]}):e.jsxs("div",{className:"flex flex-col items-start justify-start space-y-4",children:[e.jsx(v,{variant:"destructive",children:"Deshabilitada"}),e.jsx("p",{className:"text-muted-foreground",children:"Cuando habilites la autenticación de dos factores, se te solicitará un código seguro durante el inicio de sesión. Este código puede obtenerse desde una aplicación compatible con TOTP en tu teléfono."}),e.jsx("div",{children:a?e.jsxs(p,{onClick:()=>x(!0),children:[e.jsx(N,{}),"Continuar Configuración"]}):e.jsx(h,{...H.form(),onSuccess:()=>x(!0),children:({processing:f})=>e.jsxs(p,{type:"submit",disabled:f,children:[e.jsx(N,{}),"Habilitar 2FA"]})})})]}),e.jsx(je,{isOpen:u,onClose:()=>x(!1),requiresConfirmation:r,twoFactorEnabled:s,qrCodeSvg:t,manualSetupKey:i,clearSetupData:o,fetchSetupData:c,errors:l})]})})]})}export{ms as default};
